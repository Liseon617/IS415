---
title: "Take-home Exercise 1: Geospatial Analytics for Social Good: Application of Spatial and Spatio-temporal Point Patterns Analysis to discover the geographical distribution of Armed Conflict in Myanmar"
author: "Brian Lim"
date: "September 8, 2024"
date-modified: "last-modified"
categories:
  - Analysis
  - R
  - sf
  - tidyverse
  - sfdep
  - readxl
format: html
editor: visual
execute: 
  eval: true
  echo: true
  warning: false
  freeze: true
  cache.lazy: false
---

## 2.1 Exercise Overview

## 2.2 Data Acquisition

## 2.3 Getting Started

```{r}
pacman::p_load(sf, raster, spatstat, tmap, tidyverse, RColorBrewer, ggplot2, sfdep, spdep)
```

## 2.4 Importing Data into R

```{r}
thai_drug_offenses <- read.csv("data/archive/thai_drug_offenses_2017_2022.csv")%>% 
  select(-province_th)
```

```{r}
summary(thai_drug_offenses)
```

```{r}
drug_summary <- thai_drug_offenses %>%
  group_by(fiscal_year, province_en, types_of_drug_offenses) %>%
  summarize(no_cases = sum(no_cases, na.rm = TRUE), .groups = 'drop')

```

```{r}
regions_sf <- st_read(dsn = "data/tha_adm_rtsd_itos_20210121_shp", 
                layer = "tha_admbnda_adm1_rtsd_20220121")

st_crs(regions_sf)
```

```{r}
st_geometry_type(regions_sf)
```

## 2.5 Data Wrangling

```{r}
# Function to check province differences
prov_diff <- function(thai_drug_offenses_provinces, regions_sf_provinces) {
  # Create sets for efficient comparison
  drug_set <- unique(thai_drug_offenses_provinces)
  regions_set <- unique(regions_sf_provinces)
  
  # Check for mismatches
  missing_in_regions <- setdiff(drug_set, regions_set)
  missing_in_drug <- setdiff(regions_set, drug_set)
  
  if (length(missing_in_regions) == 0 && length(missing_in_drug) == 0) {
    cat("All province names match.\n")
  } else {
    cat("There are mismatches in province names.\n")
    if (length(missing_in_regions) > 0) {
      cat("Missing in regions_sf:", paste(missing_in_regions, collapse = ", "), "\n")
    }
    if (length(missing_in_drug) > 0) {
      cat("Missing in drug_sf:", paste(missing_in_drug, collapse = ", "), "\n")
    }
  }
}

prov_diff(unique(thai_drug_offenses$province_en), unique(regions_sf$ADM1_EN))
```

Based on the derived results, we would need to reassign the misaligned values such that they match exactly. In the code chunk below, we will perform the reassignment in the regions_sf

```{r}
thai_drug_offenses <- thai_drug_offenses %>%
  mutate(province_en = case_when(
    province_en == "Loburi" ~ "Lop Buri",
    province_en == "buogkan" ~ "Bueng Kan",
    TRUE ~ province_en
  ))

prov_diff(unique(thai_drug_offenses$province_en), unique(regions_sf$ADM1_EN))
```

```{r chunk_name, cache=FALSE}
drug_region_1 <- left_join(thai_drug_offenses, regions_sf, by = c("province_en" = "ADM1_EN")) %>%
  select(1:6, "date", "geometry")
```

```{r}
# Check for null values in key columns
na_count <- drug_region_1 %>%
  summarise(na_geometry = sum(is.na(geometry)),
            na_province = sum(is.na(province_en)),
            na_drug_offense = sum(is.na(types_of_drug_offenses)),
            na_cases = sum(is.na(no_cases)))

print(na_count)
```

```{r}
duplicates <- drug_region_1 %>%
  group_by(province_en, fiscal_year, types_of_drug_offenses) %>%
  filter(n() > 1) %>%
  ungroup()

if (nrow(duplicates) > 0) {
  cat("Duplicates found:\n")
  print(duplicates)
} else {
  cat("No duplicates found.\n")
}
```

```{r}
# check if drug_region_1 is an sf object
st_crs(drug_region_1)
```

```{r}
# Convert data frame to sf object and specify the CRS (EPSG:4326)
drug_region_thailand_sf <- st_as_sf(drug_region_1, crs = 4326)
```

```{r}
write_rds(drug_region_thailand_sf, "data/rds/drug_region_thailand_sf.rds")
```

```{r}
drug_region_thailand_sf <- read_rds("data/rds/drug_region_thailand_sf.rds")
```

## 2.6 Global Measures of Spatial Autocorrelation

Global measures of spatial autocorrelation, such as Moran’s I and Geary’s C, are critical in understanding the overall spatial structure of geographic data. They help detect patterns of clustering or dispersion by assessing whether similar values occur near each other across an entire study area. This insight is essential for identifying spatial dependencies and guiding decisions in fields like epidemiology, economics, and environmental science. By quantifying spatial relationships on a broad scale, global measures provide a foundational perspective for spatial analysis.

```{r, fig.height=12, fig.width=12}
num_colors <- length(unique(regions_sf$ADM1_EN))
colors <- brewer.pal(n = num_colors, name = "Set1")

# as there are 77 provinces in thailand
tmap_options(max.categories = 77)

tm_shape(regions_sf) +
  tm_polygons(col = "ADM1_EN", palette = colors) +
  tm_layout(main.title = "Provinces in Thailand",
            main.title.position = "center",
            main.title.size = 1.6,
            legend.outside = TRUE) +
  tm_legend(title = "Provinces")
```

### 2.6.1 Defining Scope of Analysis

To ensure a data-driven analysis of drug-related offenses, we aim to focus exclusively on cases that have resulted in concrete legal outcomes, such as convictions or possession cases. Cases based solely on suspicion may not lead to prosecution or final legal action, potentially inflating the data without accurately reflecting the true extent of confirmed criminal activity. By narrowing our scope to finalized or substantiated cases, we intend to provide more reliable insights into the patterns of drug-related crime and its impact.

```{r}
# Group by types_of_drug_offenses and summarize by summing the no_cases
top_drug_offenses <- thai_drug_offenses %>%
  filter(!grepl("suspect", types_of_drug_offenses, ignore.case = TRUE)) %>%
  group_by(types_of_drug_offenses) %>%
  summarise(total_cases = sum(no_cases, na.rm = TRUE)) %>%
  arrange(desc(total_cases))

# View non-suspicion based types of drug offenses
top_drug_offenses
```

We are further refining our analysis exclusively on **drug use cases**. This choice is driven by the nature of these offenses, which represent direct instances of illicit drug consumption and are critical to understanding the broader context of drug-related issues in Thailand. Unlike cases that involve suspicion or potential possession, drug use cases have clear legal implications and societal impacts, making them essential for our analysis. By focusing solely on these confirmed instances, we aim to provide accurate insights into the patterns of drug use and its repercussions.

```{r}
drug_region_thailand_sf <- drug_region_thailand_sf %>% filter(types_of_drug_offenses == "drug_use_cases")
```

Focusing exclusively on drug use cases allows us to concentrate our efforts on a significant area of concern, thereby providing clearer recommendations for law enforcement and policy development. This targeted approach ensures that our insights align with the most impactful drug-related offenses, facilitating more effective interventions and resource allocation.

```{r}
region_2017_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2017)
region_2018_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2018)
region_2019_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2019)
region_2020_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2020)
region_2021_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2021)
region_2022_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2022)
```

### 2.6.2 Computing Contiguity Neighbours

#### Year 2017

```{r}
thailand_nb_q <- st_contiguity(region_2017_sf, queen=TRUE)
summary(thailand_nb_q)
```

1 region with no links can be observed in the summary above. This is due to the **island province of Phuket** having no direct land neighbours, and being connected to **Phangnga province** via a bridge. As such, we can manually assign **Phuket** a neighbor, **Phangnga**, to help avoid issues in the spatial analysis, particularly with Moran's I, which requires each region to have at least one neighbor.

The following code chunk finds the index positions of the provinces "Phuket" and "Phangnga" within the `region_2017_sf` spatial data frame.

```{r}
phuket_index <- which(region_2017_sf$province_en == "Phuket")
phangnga_index <- which(region_2017_sf$province_en == "Phangnga")
```

Purpose: This code modifies the neighborhood relationship between "Phuket" and "Phangnga" by manually assigning them as neighbors to each other within the `thailand_nb_q` object.

```{r}
thailand_nb_q[phuket_index][1] <- phangnga_index
thailand_nb_q[phangnga_index][2] <- phuket_index
```

```{r}
summary(thailand_nb_q)
```

As seen from the summary above all regions are linked and have at least 1 neighbour

#### Computing Row-Standardised Weight Matrix

Next, we need to assign spatial weights to each neighboring polygon.

[`st_weights()`](https://rdrr.io/cran/sfdep/man/st_weights.html) function from `sfdep` packge can be used to supplement a neighbour list with spatial weights based on the chosen coding scheme. There are as least 5 different coding scheme styles supported by this function:

-   `B` is the basic binary coding

-   `W` is row standardised (sums over all links to n)

-   `C` is globally standardised (sums over all links to n)

-   `U` is equal to C divided by the number of neighbours (sums over all links to unity)

-   `S` is the variance-stabilizing coding scheme proposed by Tiefelsdorf et al. (1999) (sums over all links to n).

In this study, we will use row-standardised weight matrix (style=`"W"`). Row standardisation of a matrix ensure that the sum of the values across each row add up to 1. This is accomplished by assigning the fraction 1/(# of neighbors) to each neighboring county then summing the weighted income values. Row standardisation ensures that all weights are between 0 and 1. This facilities the interpretation of operation with the weights matrix as an averaging of neighboring values, and allows for the spatial parameter used in our analyses to be comparable between models.

```{r}
thailand_wm_rs <- st_weights(thailand_nb_q, style = "W")
```

We will mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2017_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.

```{r}
wm_q_2017 <- region_2017_sf %>%
  mutate(nb = thailand_nb_q,
         wt = thailand_wm_rs,
         .before = 1) 
```

#### Global Moran's I

::: panel-tabset
## Global Moran's I

```{r}
moranI <- global_moran(wm_q_2017$no_cases,
                        wm_q_2017$nb,
                        wm_q_2017$wt)
moranI
```

## Global Moran's I test

```{r}
global_moran_test_2017 <- global_moran_test(wm_q_2017$no_cases,
                            wm_q_2017$nb,
                            wm_q_2017$wt,
                            alternative = "greater")
global_moran_test_2017_statistics <- global_moran_test_2017$estimate["Moran I statistic"]
global_moran_test_2017_p_value <- global_moran_test_2017$p.value
global_moran_test_2017
```

For the year of **2017**, the Moran I statistic shows slight positive spatial autocorrelation, meaning there is some clustering of similar values of drug-related cases, but this clustering is weak and not statistically significant at the **5%** level (though close, with a p-value of **0.0577**). There is weak evidence suggesting that nearby provinces might have similar levels of drug-related cases, but the relationship is **not strong enough** to definitively **conclude spatial clustering**. As such, further investigation is needed to show stronger spatial autocorrelation.

## Global Moran's I permutation test

```{r}
set.seed(4242)
gmoranMC_2017 <- global_moran_perm(wm_q_2017$no_cases,
                  wm_q_2017$nb,
                  wm_q_2017$wt,
                  nsim = 999)
gmoranMC_2017
```
:::

##### Global Geary’s C

Introduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.

::: panel-tabset
## Global Geary's C test

The Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.

```{r}
global_c_test_2017 <- global_c_test(wm_q_2017$no_cases,
                                    wm_q_2017$nb,
                                    wm_q_2017$wt,
                                    alternative = "greater")
global_c_test_2017_statistics <- global_c_test_2017$estimate ["Geary C statistic"]
global_c_test_2017_p_value <- global_c_test_2017$p.value
global_c_test_2017
```

## Global Geary's C Permutation Test

Similar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.

```{r}
set.seed(4242)
bperm_2017 <- global_c_perm(wm_q_2017$no_cases,
                  wm_q_2017$nb,
                  wm_q_2017$wt,
                  nsim = 999)
bperm_2017
```
:::

#### Year 2018

Similar that of 2017, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning "Phuket" and "Phangnga" as neighbours.

```{r}
thailand_nb_q <- st_contiguity(region_2018_sf, queen=TRUE)
```

The following code chunk finds the index positions of the provinces "Phuket" and "Phangnga" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.

```{r}
phuket_index <- which(region_2018_sf$province_en == "Phuket")
phangnga_index <- which(region_2018_sf$province_en == "Phangnga")

thailand_nb_q[phuket_index][1] <- phangnga_index
thailand_nb_q[phangnga_index][2] <- phuket_index
```

#### Computing Row-Standardised Weight Matrix

Using the contiguity weight matrix, we will use row-standardised weight matrix (style = "W").

```{r}
thailand_wm_rs <- st_weights(thailand_nb_q, style = "W")
```

We then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.

```{r}
wm_q_2018 <- region_2018_sf %>%
  mutate(nb = thailand_nb_q,
         wt = thailand_wm_rs,
         .before = 1) 
```

#### Global Moran's I

::: panel-tabset
## Global Moran's I

```{r}
moranI <- global_moran(wm_q_2018$no_cases,
                        wm_q_2018$nb,
                        wm_q_2018$wt)
moranI
```

## Global Moran's I test

```{r}
global_moran_test_2018 <- global_moran_test(wm_q_2018$no_cases,
                            wm_q_2018$nb,
                            wm_q_2018$wt,
                            alternative = "greater")
global_moran_test_2018_statistics <- global_moran_test_2018$estimate["Moran I statistic"]
global_moran_test_2018_p_value <- global_moran_test_2018$p.value
global_moran_test_2018
```

For the year of **2017**, the Moran I statistic shows slight positive spatial autocorrelation, meaning there is some clustering of similar values of drug-related cases, but this clustering is weak and not statistically significant at the **5%** level (though close, with a p-value of **0.0577**). There is weak evidence suggesting that nearby provinces might have similar levels of drug-related cases, but the relationship is **not strong enough** to definitively **conclude spatial clustering**. As such, further investigation is needed to show stronger spatial autocorrelation.

## Global Moran's I permutation test

```{r}
set.seed(4242)
gmoranMC_2018 <- global_moran_perm(wm_q_2018$no_cases,
                  wm_q_2018$nb,
                  wm_q_2018$wt,
                  nsim = 999)
gmoranMC_2018
```
:::

### Global Geary’s C

Introduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.

::: panel-tabset
## Global Geary's C test

The Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.

```{r}
global_c_test_2018 <- global_c_test(wm_q_2018$no_cases,
                                    wm_q_2018$nb,
                                    wm_q_2018$wt,
                                    alternative = "greater")
global_c_test_2018_statistics <- global_c_test_2018$estimate ["Geary C statistic"]
global_c_test_2018_p_value <- global_c_test_2018$p.value
global_c_test_2018
```

## Global Geary's C Permutation Test

Similar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.

```{r}
set.seed(4242)
bperm_2018 <- global_c_perm(wm_q_2018$no_cases,
                  wm_q_2018$nb,
                  wm_q_2018$wt,
                  nsim = 999)
bperm_2018
```
:::

### Year 2019

Similar that of 2017, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning "Phuket" and "Phangnga" as neighbours.

```{r}
thailand_nb_q <- st_contiguity(region_2019_sf, queen=TRUE)
```

The following code chunk finds the index positions of the provinces "Phuket" and "Phangnga" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.

```{r}
phuket_index <- which(region_2019_sf$province_en == "Phuket")
phangnga_index <- which(region_2019_sf$province_en == "Phangnga")

thailand_nb_q[phuket_index][1] <- phangnga_index
thailand_nb_q[phangnga_index][2] <- phuket_index
```

#### Computing Row-Standardised Weight Matrix

Using the contiguity weight matrix, we will use row-standardised weight matrix (style = "W").

```{r}
thailand_wm_rs <- st_weights(thailand_nb_q, style = "W")
```

We then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.

```{r}
wm_q_2019 <- region_2019_sf %>%
  mutate(nb = thailand_nb_q,
         wt = thailand_wm_rs,
         .before = 1) 
```

#### Global Moran's I

::: panel-tabset
## Global Moran's I

```{r}
moranI <- global_moran(wm_q_2019$no_cases,
                        wm_q_2019$nb,
                        wm_q_2019$wt)
moranI
```

## Global Moran's I test

```{r}
global_moran_test_2019 <- global_moran_test(wm_q_2019$no_cases,
                            wm_q_2019$nb,
                            wm_q_2019$wt,
                            alternative = "greater")
global_moran_test_2019_statistics <- global_moran_test_2019$estimate["Moran I statistic"]
global_moran_test_2019_p_value <- global_moran_test_2019$p.value
global_moran_test_2019
```

For the year of **2017**, the Moran I statistic shows slight positive spatial autocorrelation, meaning there is some clustering of similar values of drug-related cases, but this clustering is weak and not statistically significant at the **5%** level (though close, with a p-value of **0.0577**). There is weak evidence suggesting that nearby provinces might have similar levels of drug-related cases, but the relationship is **not strong enough** to definitively **conclude spatial clustering**. As such, further investigation is needed to show stronger spatial autocorrelation.

## Global Moran's I permutation test

```{r}
set.seed(4242)
gmoranMC_2019 <- global_moran_perm(wm_q_2019$no_cases,
                  wm_q_2019$nb,
                  wm_q_2019$wt,
                  nsim = 999)
gmoranMC_2019
```
:::

### Global Geary’s C

Introduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.

::: panel-tabset
## Global Geary's C test

The Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.

```{r}
global_c_test_2019 <- global_c_test(wm_q_2019$no_cases,
                                    wm_q_2019$nb,
                                    wm_q_2019$wt,
                                    alternative = "greater")
global_c_test_2019_statistics <- global_c_test_2019$estimate ["Geary C statistic"]
global_c_test_2019_p_value <- global_c_test_2019$p.value
global_c_test_2019
```

## Global Geary's C Permutation Test

Similar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.

```{r}
set.seed(4242)
bperm_2019 <- global_c_perm(wm_q_2019$no_cases,
                  wm_q_2019$nb,
                  wm_q_2019$wt,
                  nsim = 999)
bperm_2019
```
:::

#### Year 2020

Similar that of 2017, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning "Phuket" and "Phangnga" as neighbours.

```{r}
thailand_nb_q <- st_contiguity(region_2020_sf, queen=TRUE)
```

The following code chunk finds the index positions of the provinces "Phuket" and "Phangnga" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.

```{r}
phuket_index <- which(region_2020_sf$province_en == "Phuket")
phangnga_index <- which(region_2020_sf$province_en == "Phangnga")

thailand_nb_q[phuket_index][1] <- phangnga_index
thailand_nb_q[phangnga_index][2] <- phuket_index
```

#### Computing Row-Standardised Weight Matrix

Using the contiguity weight matrix, we will use row-standardised weight matrix (style = "W").

```{r}
thailand_wm_rs <- st_weights(thailand_nb_q, style = "W")
```

We then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.

```{r}
wm_q_2020 <- region_2020_sf %>%
  mutate(nb = thailand_nb_q,
         wt = thailand_wm_rs,
         .before = 1) 
```

#### Global Moran's I

::: panel-tabset
## Global Moran's I

```{r}
moranI <- global_moran(wm_q_2020$no_cases,
                        wm_q_2020$nb,
                        wm_q_2020$wt)
moranI
```

## Global Moran's I test

```{r}
global_moran_test_2020 <- global_moran_test(wm_q_2020$no_cases,
                            wm_q_2020$nb,
                            wm_q_2020$wt,
                            alternative = "greater")
global_moran_test_2020_statistics <- global_moran_test_2020$estimate["Moran I statistic"]
global_moran_test_2020_p_value <- global_moran_test_2020$p.value
global_moran_test_2020
```

For the year of **2017**, the Moran I statistic shows slight positive spatial autocorrelation, meaning there is some clustering of similar values of drug-related cases, but this clustering is weak and not statistically significant at the **5%** level (though close, with a p-value of **0.0577**). There is weak evidence suggesting that nearby provinces might have similar levels of drug-related cases, but the relationship is **not strong enough** to definitively **conclude spatial clustering**. As such, further investigation is needed to show stronger spatial autocorrelation.

## Global Moran's I permutation test

```{r}
set.seed(4242)
gmoranMC_2020 <- global_moran_perm(wm_q_2020$no_cases,
                  wm_q_2020$nb,
                  wm_q_2020$wt,
                  nsim = 999)
gmoranMC_2020
```
:::

### Global Geary’s C

Introduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.

::: panel-tabset
## Global Geary's C test

The Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.

```{r}
global_c_test_2020 <- global_c_test(wm_q_2020$no_cases,
                                    wm_q_2020$nb,
                                    wm_q_2020$wt,
                                    alternative = "greater")
global_c_test_2020_statistics <- global_c_test_2020$estimate ["Geary C statistic"]
global_c_test_2020_p_value <- global_c_test_2020$p.value
global_c_test_2020
```

## Global Geary's C Permutation Test

Similar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.

```{r}
set.seed(4242)
bperm_2020 <- global_c_perm(wm_q_2020$no_cases,
                  wm_q_2020$nb,
                  wm_q_2020$wt,
                  nsim = 999)
bperm_2020
```
:::

#### Year 2021

Similar that of 2017, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning "Phuket" and "Phangnga" as neighbours.

```{r}
thailand_nb_q <- st_contiguity(region_2021_sf, queen=TRUE)
```

The following code chunk finds the index positions of the provinces "Phuket" and "Phangnga" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.

```{r}
phuket_index <- which(region_2021_sf$province_en == "Phuket")
phangnga_index <- which(region_2021_sf$province_en == "Phangnga")

thailand_nb_q[phuket_index][1] <- phangnga_index
thailand_nb_q[phangnga_index][2] <- phuket_index
```

#### Computing Row-Standardised Weight Matrix

Using the contiguity weight matrix, we will use row-standardised weight matrix (style = "W").

```{r}
thailand_wm_rs <- st_weights(thailand_nb_q, style = "W")
```

We then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.

```{r}
wm_q_2021 <- region_2021_sf %>%
  mutate(nb = thailand_nb_q,
         wt = thailand_wm_rs,
         .before = 1) 
```

#### Global Moran's I

::: panel-tabset
## Global Moran's I

```{r}
moranI <- global_moran(wm_q_2021$no_cases,
                        wm_q_2021$nb,
                        wm_q_2021$wt)
moranI
```

## Global Moran's I test

```{r}
global_moran_test_2021 <- global_moran_test(wm_q_2021$no_cases,
                            wm_q_2021$nb,
                            wm_q_2021$wt,
                            alternative = "greater")
global_moran_test_2021_statistics <- global_moran_test_2021$estimate["Moran I statistic"]
global_moran_test_2021_p_value <- global_moran_test_2021$p.value
global_moran_test_2021
```

For the year of **2017**, the Moran I statistic shows slight positive spatial autocorrelation, meaning there is some clustering of similar values of drug-related cases, but this clustering is weak and not statistically significant at the **5%** level (though close, with a p-value of **0.0577**). There is weak evidence suggesting that nearby provinces might have similar levels of drug-related cases, but the relationship is **not strong enough** to definitively **conclude spatial clustering**. As such, further investigation is needed to show stronger spatial autocorrelation.

## Global Moran's I permutation test

```{r}
set.seed(4242)
gmoranMC_2021 <- global_moran_perm(wm_q_2021$no_cases,
                  wm_q_2021$nb,
                  wm_q_2021$wt,
                  nsim = 999)
gmoranMC_2021
```
:::

### Global Geary’s C

Introduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.

::: panel-tabset
## Global Geary's C test

The Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.

```{r}
global_c_test_2021 <- global_c_test(wm_q_2021$no_cases,
                                    wm_q_2021$nb,
                                    wm_q_2021$wt,
                                    alternative = "greater")
global_c_test_2021_statistics <- global_c_test_2021$estimate ["Geary C statistic"]
global_c_test_2021_p_value <- global_c_test_2021$p.value
global_c_test_2021
```

## Global Geary's C Permutation Test

Similar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.

```{r}
set.seed(4242)
bperm_2021 <- global_c_perm(wm_q_2021$no_cases,
                  wm_q_2021$nb,
                  wm_q_2021$wt,
                  nsim = 999)
bperm_2021
```
:::

#### Year 2022

Similar that of 2017, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning "Phuket" and "Phangnga" as neighbours.

```{r}
thailand_nb_q <- st_contiguity(region_2022_sf, queen=TRUE)
```

The following code chunk finds the index positions of the provinces "Phuket" and "Phangnga" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.

```{r}
phuket_index <- which(region_2022_sf$province_en == "Phuket")
phangnga_index <- which(region_2022_sf$province_en == "Phangnga")

thailand_nb_q[phuket_index][1] <- phangnga_index
thailand_nb_q[phangnga_index][2] <- phuket_index
```

#### Computing Row-Standardised Weight Matrix

Using the contiguity weight matrix, we will use row-standardised weight matrix (style = "W").

```{r}
thailand_wm_rs <- st_weights(thailand_nb_q, style = "W")
```

We then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.

```{r}
wm_q_2022 <- region_2022_sf %>%
  mutate(nb = thailand_nb_q,
         wt = thailand_wm_rs,
         .before = 1) 
```

#### Global Moran's I

::: panel-tabset
## Global Moran's I

```{r}
moranI <- global_moran(wm_q_2022$no_cases,
                        wm_q_2022$nb,
                        wm_q_2022$wt)
moranI
```

## Global Moran's I test

```{r}
global_moran_test_2022 <- global_moran_test(wm_q_2022$no_cases,
                            wm_q_2022$nb,
                            wm_q_2022$wt,
                            alternative = "greater")
global_moran_test_2022_statistics <- global_moran_test_2022$estimate["Moran I statistic"]
global_moran_test_2022_p_value <- global_moran_test_2022$p.value
global_moran_test_2022
```

For the year of **2017**, the Moran I statistic shows slight positive spatial autocorrelation, meaning there is some clustering of similar values of drug-related cases, but this clustering is weak and not statistically significant at the **5%** level (though close, with a p-value of **0.0577**). There is weak evidence suggesting that nearby provinces might have similar levels of drug-related cases, but the relationship is **not strong enough** to definitively **conclude spatial clustering**. As such, further investigation is needed to show stronger spatial autocorrelation.

## Global Moran's I permutation test

```{r}
set.seed(4242)
gmoranMC_2022 <- global_moran_perm(wm_q_2022$no_cases,
                  wm_q_2022$nb,
                  wm_q_2022$wt,
                  nsim = 999)
gmoranMC_2022
```
:::

### Global Geary’s C

Introduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.

::: panel-tabset
## Global Geary's C test

The Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.

```{r}
global_c_test_2022 <- global_c_test(wm_q_2022$no_cases,
                                    wm_q_2022$nb,
                                    wm_q_2022$wt,
                                    alternative = "greater")
global_c_test_2022_statistics <- global_c_test_2022$estimate ["Geary C statistic"]
global_c_test_2022_p_value <- global_c_test_2022$p.value
global_c_test_2022
```

## Global Geary's C Permutation Test

Similar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.

```{r}
set.seed(4242)
bperm_2022 <- global_c_perm(wm_q_2022$no_cases,
                  wm_q_2022$nb,
                  wm_q_2022$wt,
                  nsim = 999)
bperm_2022
```
:::

### 2.6.3 Global Moran's I Permutation test

```{r, fig.height=12, fig.width=12}
# List of gmoranMC objects for each year
gmoranMC_list <- list(gmoranMC_2017, gmoranMC_2018, gmoranMC_2019, 
                      gmoranMC_2020, gmoranMC_2021, gmoranMC_2022)

# Corresponding year labels for the titles
year_labels <- c("2017", "2018", "2019", "2020", "2021", "2022")

# Set up the plotting area to have 3 rows and 2 columns for the six histograms
par(mfrow = c(3, 2))

# Loop through each year and plot the histogram
for (i in 1:length(gmoranMC_list)) {
  gmoranMC <- gmoranMC_list[[i]]
  year <- year_labels[i]
  
  # Plot the histogram for the current year
  hist(gmoranMC$res, 
       main = paste("Global Moran's I MC Results", year), 
       breaks = 20,
       xlab = "Monte-Carlo Results", 
       ylab = "Frequency")
  
  # Add a vertical line for the observed Moran's I statistic
  abline(v = gmoranMC$statistic, col = "red")
}
```

### 2.6.4 Global Geary's C Permutation test

::: panel-tabset
```{r, fig.height=12, fig.width=12}
# List of bperm objects for each year
gmoranMC_list <- list(bperm_2017, bperm_2018, bperm_2019, 
                      bperm_2020, bperm_2021, bperm_2022)

# Corresponding year labels for the titles
year_labels <- c("2017", "2018", "2019", "2020", "2021", "2022")

# Set up the plotting area to have 3 rows and 2 columns for the six histograms
par(mfrow = c(3, 2))

# Loop through each year and plot the histogram
for (i in 1:length(gmoranMC_list)) {
  gmoranMC <- gmoranMC_list[[i]]
  year <- year_labels[i]
  
  # Plot the histogram for the current year
  hist(gmoranMC$res, 
       main = paste("Global Moran's I MC Results", year),
       breaks = 20,
       xlab = "Monte-Carlo Results", 
       ylab = "Frequency")
  
  # Add a vertical line for the observed Moran's I statistic
  abline(v = gmoranMC$statistic, col = "red")
}
```
:::

### 2.6.5 Temporal Trends (2017-2022)

We can then analyze the spatial patterns of drug-related cases in Thailand over the period from 2017 to 2022 using Moran’s I and Geary’s C global spatial autocorrelation tests. The Moran’s I statistic identifies whether similar case values are clustered across regions, while Geary’s C focuses on local-level similarity, both crucial in understanding the distribution of drug-related offenses over time.

```{r}
# Create a data frame to store Moran's I statistics and p-values
moran_i_results <- data.frame(
  Year = c(2017, 2018, 2019, 2020, 2021, 2022),
  Moran_I_Stat = c(global_moran_test_2017_statistics, global_moran_test_2018_statistics,
                   global_moran_test_2019_statistics, global_moran_test_2020_statistics,
                   global_moran_test_2021_statistics, global_moran_test_2022_statistics),
  Moran_I_p_value = c(global_moran_test_2017_p_value, global_moran_test_2018_p_value,
                      global_moran_test_2019_p_value, global_moran_test_2020_p_value,
                      global_moran_test_2021_p_value, global_moran_test_2022_p_value)
)

# Consolidate the Geary C test data into a data frame
geary_c_results <- data.frame(
  Year = c(2017, 2018, 2019, 2020, 2021, 2022),
  Geary_C_Stat = c(global_c_test_2017_statistics, global_c_test_2018_statistics, 
                   global_c_test_2019_statistics, global_c_test_2020_statistics, 
                   global_c_test_2021_statistics, global_c_test_2022_statistics),
  Geary_C_p_value = c(global_c_test_2017_p_value, global_c_test_2018_p_value, 
                      global_c_test_2019_p_value, global_c_test_2020_p_value, 
                      global_c_test_2021_p_value, global_c_test_2022_p_value)
)
```

::: **Moran’s I (2017 - 2022)** 2017: Moran’s I = 0.0821, p-value = 0.0577 2018: Moran’s I = 0.0952, p-value = 0.0423 2019: Moran’s I = 0.1410, p-value = 0.0149 2020: Moran’s I = 0.0875, p-value = 0.0835 2021: Moran’s I = 0.2013, p-value = 0.0024 2022: Moran’s I = 0.2133, p-value = 0.0015

**Geary’s C (2017 - 2022)** 2017: Geary’s C = 1.0258, p-value = 0.5714 2018: Geary’s C = 1.0037, p-value = 0.5106 2019: Geary’s C = 0.9167, p-value = 0.2260 2020: Geary’s C = 0.9528, p-value = 0.3234 2021: Geary’s C = 0.8489, p-value = 0.0433 2022: Geary’s C = 0.8377, p-value = 0.0292 :::

```{r}
# Plot Moran's I Statistic over the years
ggplot(moran_i_results, aes(x = Year, y = Moran_I_Stat)) +
  geom_line() + 
  geom_point() +
  labs(title = "Moran's I Statistic Trend (2017-2022)", 
       x = "Year", 
       y = "Moran's I Statistic") +
  theme_minimal()
```

```{r}
# Plot p-values over the years
ggplot(moran_i_results, aes(x = Year, y = Moran_I_p_value)) +
  geom_line() + 
  geom_point() +
  geom_hline(yintercept = 0.05, linetype = "dashed", color = "red") +  # Significance threshold
  labs(title = "Moran's I Test p-values (2017-2022)", 
       x = "Year", 
       y = "p-value") +
  theme_minimal()
```

::: {.callout-tip title="Reflection"}
**Moran’s I (2017 - 2022)**

**2017**: Moran’s I = 0.0821, p-value = 0.0577

**2018**: Moran’s I = 0.0952, p-value = 0.0423

**2019**: Moran’s I = 0.1410, p-value = 0.0149

**2020**: Moran’s I = 0.0875, p-value = 0.0835

**2021**: Moran’s I = 0.2013, p-value = 0.0024

**2022**: Moran’s I = 0.2133, p-value = 0.0015

**Key Insights**:

-   **2017–2019**: There is a gradual increase in spatial autocorrelation, with clustering becoming statistically significant by **2018** and peaking in **2019**.

-   **2020**: A slight drop in Moran’s I indicates weaker spatial clustering, and the p-value suggests the autocorrelation is no longer significant. This could indicate that drug-related cases became more dispersed or random in 2020.

-   **2021–2022**: A sharp rise in Moran’s I shows that spatial clustering of drug-related cases became very strong in these years, and it is statistically significant with p-values well below 0.05. Drug-related cases are now highly concentrated in certain areas.
:::

```{r}
# Plot Geary C Statistic over the years
ggplot(geary_c_results, aes(x = Year, y = Geary_C_Stat)) +
  geom_line() + 
  geom_point() +
  labs(title = "Geary C Statistic Trend (2017-2022)", 
       x = "Year", 
       y = "Geary C Statistic") +
  theme_minimal()
```

```{r}
# Plot p-values over the years
ggplot(geary_c_results, aes(x = Year, y = Geary_C_p_value)) +
  geom_line() + 
  geom_point() +
  geom_hline(yintercept = 0.05, linetype = "dashed", color = "red") +  # Mark significance threshold
  labs(title = "Geary C Test p-values (2017-2022)", 
       x = "Year", 
       y = "p-value") +
  theme_minimal()
```

::: {.callout-tip title="Reflection"}
**Geary’s C (2017 - 2022)**

**2017**: Geary’s C = 1.0258, p-value = 0.5714

**2018**: Geary’s C = 1.0037, p-value = 0.5106

**2019**: Geary’s C = 0.9167, p-value = 0.2260

**2020**: Geary’s C = 0.9528, p-value = 0.3234

**2021**: Geary’s C = 0.8489, p-value = 0.0433

**2022**: Geary’s C = 0.8377, p-value = 0.0292

**Key Insights**:

-   **2017–2018**: Geary’s C values are very close to 1, indicating no significant spatial autocorrelation, meaning the distribution of drug-related cases was largely random.

-   **2019**: The Geary’s C statistic starts to dip below 1, indicating emerging spatial autocorrelation, though it is not yet statistically significant.

-   **2020**: Geary’s C rises slightly, indicating a slight weakening of spatial autocorrelation, but the cases are still mostly random with no significant clustering.

-   **2021–2022**: A marked decrease in Geary’s C below 1, coupled with p-values dropping below 0.05, suggests significant clustering of similar values. This means that in the last two years, drug-related cases are no longer random and are now highly clustered.
:::

### 2.6.6 Conclusion

From 2017 to 2022, both Moran’s I and Geary’s C statistics reveal an evolving spatial structure of drug-related cases. While earlier years exhibit weaker or random spatial patterns, by 2021 and 2022, significant clustering emerged, indicating an increase in spatial autocorrelation. This shift reflects that drug-related incidents are becoming more concentrated in specific areas, which could suggest targeted intervention zones for policy and law enforcement.

## 2.7 Local Measures of Spatial Autocorrelation

Building on the insights gained from global measures, local spatial autocorrelation focuses on identifying specific regions within the broader area that deviate from global trends. Techniques like Local Moran’s I allow for the detection of localized clusters and outliers, revealing spatial heterogeneity that might be masked by global statistics. This localized approach is crucial for pinpointing areas of high significance, enabling targeted interventions and more refined spatial decision-making.

### 2.7.1 Local Moran's I

::: panel-tabset
## Year 2017

```{r}
head(wm_q_2017)
```

```{r}
lisa_2017 <- wm_q_2017 %>% 
  mutate(local_moran = local_moran(
    no_cases, nb, wt, nsim = 99),
         .before = 1) %>%
  unnest(local_moran)
lisa_2017
```

### Visualising Local Moran’s I_i

```{r, fig.height=12, fig.width=15}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2017)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Province-level Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Local Moran’s I_i p-value

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2017)+
  tm_fill("p_ii_sim", 
          palette = c("#b7dce9","#c9e3d2","#f5f3a6","#ec9a64","#d21b1c"),
          title = "p-value",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Statistically Significant Local Spatial Autocorrelation Map

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
lisa_2017_sig <- lisa_2017  %>%
  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)

tm_shape(lisa_2017)+
  tm_polygons() +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(lisa_2017_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistically Significant Village-Level Spatial Autocorrelation Map of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

## Year 2018

```{r}
head(wm_q_2018)
```

```{r}
lisa_2018 <- wm_q_2018 %>% 
  mutate(local_moran = local_moran(
    no_cases, nb, wt, nsim = 99),
         .before = 1) %>%
  unnest(local_moran)
lisa_2018
```

### Visualising Local Moran’s I_i

```{r, fig.height=12, fig.width=15}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2018)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Province-level Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Local Moran’s I_i p-value

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2018)+
  tm_fill("p_ii_sim", 
          palette = c("#b7dce9","#c9e3d2","#f5f3a6","#ec9a64","#d21b1c"),
          title = "p-value",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Statistically Significant Local Spatial Autocorrelation Map

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
lisa_2018_sig <- lisa_2018  %>%
  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)

tm_shape(lisa_2018)+
  tm_polygons() +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(lisa_2018_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistically Significant Village-Level Spatial Autocorrelation Map of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

## Year 2019

```{r}
head(wm_q_2019)
```

```{r}
lisa_2019 <- wm_q_2019 %>% 
  mutate(local_moran = local_moran(
    no_cases, nb, wt, nsim = 99),
         .before = 1) %>%
  unnest(local_moran)
lisa_2019
```

### Visualising Local Moran’s I_i

```{r, fig.height=12, fig.width=15}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2019)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Province-level Spatial Autocorrelation \nof Drug related offenses in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Local Moran’s I_i p-value

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2019)+
  tm_fill("p_ii_sim", 
          palette = c("#b7dce9","#c9e3d2","#f5f3a6","#ec9a64","#d21b1c"),
          title = "p-value",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Statistically Significant Local Spatial Autocorrelation Map

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
lisa_2019_sig <- lisa_2019  %>%
  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)

tm_shape(lisa_2019)+
  tm_polygons() +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(lisa_2019_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistically Significant Village-Level Spatial Autocorrelation Map of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

## Year 2020

```{r}
head(wm_q_2020)
```

```{r}
lisa_2020 <- wm_q_2020 %>% 
  mutate(local_moran = local_moran(
    no_cases, nb, wt, nsim = 99),
         .before = 1) %>%
  unnest(local_moran)
lisa_2020
```

### Visualising Local Moran’s I_i

```{r, fig.height=12, fig.width=15}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2020)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Province-level Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Local Moran’s I_i p-value

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2020)+
  tm_fill("p_ii_sim", 
          palette = c("#b7dce9","#c9e3d2","#f5f3a6","#ec9a64","#d21b1c"),
          title = "p-value",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Statistically Significant Local Spatial Autocorrelation Map

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
lisa_2020_sig <- lisa_2020  %>%
  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)

tm_shape(lisa_2020)+
  tm_polygons() +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(lisa_2020_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistically Significant Village-Level Spatial Autocorrelation Map of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

## Year 2021

```{r}
head(wm_q_2021)
```

```{r}
lisa_2021 <- wm_q_2021 %>% 
  mutate(local_moran = local_moran(
    no_cases, nb, wt, nsim = 99),
         .before = 1) %>%
  unnest(local_moran)
lisa_2021
```

### Visualising Local Moran’s I_i

```{r, fig.height=12, fig.width=15}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2021)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Province-level Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Local Moran’s I_i p-value

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2021)+
  tm_fill("p_ii_sim", 
          palette = c("#b7dce9","#c9e3d2","#f5f3a6","#ec9a64","#d21b1c"),
          title = "p-value",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Statistically Significant Local Spatial Autocorrelation Map

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
lisa_2021_sig <- lisa_2021  %>%
  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)

tm_shape(lisa_2021)+
  tm_polygons() +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(lisa_2021_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistically Significant Village-Level Spatial Autocorrelation Map of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

## Year 2022

```{r}
head(wm_q_2022)
```

```{r}
lisa_2022 <- wm_q_2022 %>% 
  mutate(local_moran = local_moran(
    no_cases, nb, wt, nsim = 99),
         .before = 1) %>%
  unnest(local_moran)
lisa_2022
```

### Visualising Local Moran’s I_i

```{r, fig.height=12, fig.width=15}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2022)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Province-level Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Local Moran’s I_i p-value

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
tm_shape(lisa_2022)+
  tm_fill("p_ii_sim", 
          palette = c("#b7dce9","#c9e3d2","#f5f3a6","#ec9a64","#d21b1c"),
          title = "p-value",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```

### Visualising Statistically Significant Local Spatial Autocorrelation Map

```{r, fig.height=12, fig.width=12}
#| code-fold: true
#| code-summary: "Show the code"
lisa_2022_sig <- lisa_2022  %>%
  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)

tm_shape(lisa_2022)+
  tm_polygons() +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(lisa_2022_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                      "#f8d887","#ec9a64","#d21b1c"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistically Significant Village-Level Spatial Autocorrelation Map of drug use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 3, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)
```
:::

### Statistically Significant Local Spatial Autocorrelation Map (2017 - 2022)

```{r, fig.height=12, fig.width=12}
# Load grid package for overall title
library(grid)

# List of data for each year
lisa_data <- list(
  "2017" = list(lisa = lisa_2017, sig = lisa_2017_sig),
  "2018" = list(lisa = lisa_2018, sig = lisa_2018_sig),
  "2019" = list(lisa = lisa_2019, sig = lisa_2019_sig),
  "2020" = list(lisa = lisa_2020, sig = lisa_2020_sig),
  "2021" = list(lisa = lisa_2021, sig = lisa_2021_sig),
  "2022" = list(lisa = lisa_2022, sig = lisa_2022_sig)
)

# Initialize an empty list to store tmap objects
maps <- list()

# Loop through each year's data and create a map
for (year in names(lisa_data)) {
  map <- tm_shape(lisa_data[[year]]$lisa) +
    tm_polygons(id = "label") +
    tm_borders(col = "black", alpha = 0.6) +
  tm_shape(lisa_data[[year]]$sig) +
    tm_fill("ii", 
            palette = c("#b7dce9","#e1ecbb","#f5f3a6",
                        "#f8d887","#ec9a64","#d21b1c"),
            title = paste("Local Moran's I", year, "(p < 0.05)"),
            midpoint = NA,
            id = "label") +
    tm_borders(col = "black", alpha = 0.6) +
    # Add title to individual plot
    tm_layout(title = paste("Year", year), title.position = c("center", "top"))
  
  # Store the map in the list
  maps[[year]] <- map
}

# Arrange the maps side by side
tmap_arrange(
  maps$`2017`, maps$`2018`, maps$`2019`,
  maps$`2020`, maps$`2021`, maps$`2022`,
  ncol = 3
)
```

### 2.7.2 Visualising Statistically Significant Local Spatial Autocorrelation Map (Regions)

#### 2.7.2.1 Regionalising the province of Thailand

Thailand is variably divided into different sets of regions, the most notable of which are the six-region grouping used in geographic studies, and the four-region grouping consistent with the Monthon administrative regional grouping system formerly used by the Ministry of Interior. These regions are the largest subdivisions of the country.

In contrast to the administrative divisions of the provinces of Thailand, the regions no longer have an administrative character, but are used for statistical or academic purposes.

A six-region system is commonly used for geographical and scientific purposes. This system dates to 1935. It was formalised in 1977 by the National Geographical Committee, which was appointed by the National Research Council. It divides the country into the following regions:

-   Northern Thailand
-   Northeastern Thailand
-   Western Thailand
-   Central Thailand
-   Eastern Thailand
-   Southern Thailand

The four-region system, used in some administrative and statistical contexts, and also as a loose cultural grouping, includes the western and eastern regions within the central region, while grouping the provinces of Sukhothai, Phitsanulok, Phichit, Kamphaeng Phet, Phetchabun, Nakhon Sawan, and Uthai Thani in the northern region. This is also the regional system most commonly used on national television, when discussing regional events. It divides the country into the following regions:

-   Northern Thailand
-   Northeastern Thailand (Isan)
-   Central Thailand
-   Southern Thailand

The Thai Meteorological Department divides the country into six regions for meteorological purposes. It differs from the four-region system in that the east is regarded as a separate region, the south is divided into east and west coasts, and Nakhon Sawan and Uthai Thani are grouped in the central region.

![](data/distribution.png)

Given the geographical scope of the study, we will adopt a six-region geographical distribution, focusing on the provincial level. This approach not only allows for a regionally nuanced analysis but also reduces the computational load within the R environment, making the analysis more efficient.

```{r}
# Define provinces for each region
northeastern <- c("Amnat Charoen", "Bueng Kan", "Buri Ram", "Chaiyaphum", "Kalasin", 
                  "Khon Kaen", "Loei", "Maha Sarakham", "Mukdahan", "Nakhon Phanom", 
                  "Nakhon Ratchasima", "Nong Bua Lam Phu", "Nong Khai", "Roi Et", 
                  "Sakon Nakhon", "Si Sa Ket", "Surin", "Ubon Ratchathani", "Udon Thani", 
                  "Yasothon")

northern <- c("Chiang Mai", "Chiang Rai", "Lampang", "Lamphun", "Mae Hong Son", 
              "Nan", "Phayao", "Phrae", "Uttaradit")

western <- c("Tak", "Kanchanaburi", "Ratchaburi", "Phetchaburi", "Prachuap Khiri Khan")

central <- c("Kamphaeng Phet", "Phetchabun", "Phichit", "Phitsanulok", "Sukhothai", 
             "Nakhon Sawan", "Uthai Thani", "Ang Thong", "Bangkok", "Chai Nat", 
             "Lop Buri", "Nakhon Pathom", "Nonthaburi", "Pathum Thani", 
             "Phra Nakhon Si Ayutthaya", "Samut Prakan", "Samut Sakhon", 
             "Samut Songkhram", "Saraburi", "Sing Buri", "Suphan Buri", "Nakhon Nayok")

eastern <- c("Chachoengsao", "Chanthaburi", "Chon Buri", "Prachin Buri", "Rayong", 
             "Sa Kaeo", "Trat")

southern <- c("Chumphon", "Nakhon Si Thammarat", "Narathiwat", "Pattani", 
              "Phatthalung", "Songkhla", "Surat Thani", "Yala", "Krabi", 
              "Phangnga", "Phuket", "Ranong", "Satun", "Trang")
```

::: panel-tabset
## Year 2017

```{r}
northeastern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% northeastern)
northern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% northern)
western_lisa_2017 <- lisa_2017 %>% filter(province_en %in% western)
central_lisa_2017 <- lisa_2017 %>% filter(province_en %in% central)
eastern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% eastern)
southern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% southern)

northeastern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% northeastern)
northern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% northern)
western_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% western)
central_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% central)
eastern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% eastern)
southern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% southern)
```

### Northeastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12
northeastern_local <- tm_shape(northeastern_lisa_2017)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northeastern_sig <- tm_shape(northeastern_lisa_2017)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)
```

### Northern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northern_local <- tm_shape(northern_lisa_2017)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northern_sig <- tm_shape(northern_lisa_2017)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northern_local,northern_sig, asp=1, ncol=2)
```

### Western Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

western_local <- tm_shape(western_lisa_2017)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

western_sig <- tm_shape(western_lisa_2017)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(western_local,western_sig, asp=1, ncol=2)
```

### Central Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12
central_local <- tm_shape(central_lisa_2017)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

central_sig <- tm_shape(central_lisa_2017)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(central_local,central_sig, asp=1, ncol=2)
```

### Eastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

eastern_local <- tm_shape(eastern_lisa_2017)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

eastern_sig <- tm_shape(eastern_lisa_2017)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)
```

### Southern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

southern_local <- tm_shape(southern_lisa_2017)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

southern_sig <- tm_shape(southern_lisa_2017)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(southern_local,southern_sig, asp=1, ncol=2)
```

### Analysis & Discussion

The central district

```{r}
#| code-fold: true
#| code-summary: "Show the code"

tm_shape(central_lisa_2017)+
  tm_polygons(id="label") +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(central_lisa_2017_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          id="label")+
  tm_borders(col = "black", alpha = 0.6)
```

## Year 2018

```{r}
northeastern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% northeastern)
northern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% northern)
western_lisa_2018 <- lisa_2018 %>% filter(province_en %in% western)
central_lisa_2018 <- lisa_2018 %>% filter(province_en %in% central)
eastern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% eastern)
southern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% southern)

northeastern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% northeastern)
northern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% northern)
western_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% western)
central_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% central)
eastern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% eastern)
southern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% southern)
```

### Northeastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northeastern_local <- tm_shape(northeastern_lisa_2018)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northeastern_sig <- tm_shape(northeastern_lisa_2018)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)
```

### Northern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northern_local <- tm_shape(northern_lisa_2018)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northern_sig <- tm_shape(northern_lisa_2018)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northern_local,northern_sig, asp=1, ncol=2)
```

### Western Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

western_local <- tm_shape(western_lisa_2018)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

western_sig <- tm_shape(western_lisa_2018)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(western_local,western_sig, asp=1, ncol=2)
```

### Central Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

central_local <- tm_shape(central_lisa_2018)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

central_sig <- tm_shape(central_lisa_2018)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(central_local,central_sig, asp=1, ncol=2)
```

### Eastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

eastern_local <- tm_shape(eastern_lisa_2018)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

eastern_sig <- tm_shape(eastern_lisa_2018)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)
```

### Southern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

southern_local <- tm_shape(southern_lisa_2018)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

southern_sig <- tm_shape(southern_lisa_2018)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(southern_local,southern_sig, asp=1, ncol=2)
```

### Analysis & Discussion

The central district

```{r}
#| code-fold: true
#| code-summary: "Show the code"

tm_shape(central_lisa_2018)+
  tm_polygons(id="label") +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(central_lisa_2018_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          id="label")+
  tm_borders(col = "black", alpha = 0.6)
```

## Year 2019

```{r}
northeastern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% northeastern)
northern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% northern)
western_lisa_2019 <- lisa_2019 %>% filter(province_en %in% western)
central_lisa_2019 <- lisa_2019 %>% filter(province_en %in% central)
eastern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% eastern)
southern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% southern)

northeastern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% northeastern)
northern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% northern)
western_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% western)
central_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% central)
eastern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% eastern)
southern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% southern)
```

### Northeastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northeastern_local <- tm_shape(northeastern_lisa_2019)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northeastern_sig <- tm_shape(northeastern_lisa_2019)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)
```

### Northern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northern_local <- tm_shape(northern_lisa_2019)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northern_sig <- tm_shape(northern_lisa_2019)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northern_local,northern_sig, asp=1, ncol=2)
```

### Western Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

western_local <- tm_shape(western_lisa_2019)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

western_sig <- tm_shape(western_lisa_2019)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(western_local,western_sig, asp=1, ncol=2)
```

### Central Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

central_local <- tm_shape(central_lisa_2019)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

central_sig <- tm_shape(central_lisa_2019)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(central_local,central_sig, asp=1, ncol=2)
```

### Eastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

eastern_local <- tm_shape(eastern_lisa_2019)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

eastern_sig <- tm_shape(eastern_lisa_2019)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)
```

### Southern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

southern_local <- tm_shape(southern_lisa_2019)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

southern_sig <- tm_shape(southern_lisa_2019)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(southern_local,southern_sig, asp=1, ncol=2)
```

### Analysis & Discussion

The central district

```{r}
#| code-fold: true
#| code-summary: "Show the code"

tm_shape(central_lisa_2019)+
  tm_polygons(id="label") +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(central_lisa_2019_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          id="label")+
  tm_borders(col = "black", alpha = 0.6)
```

## Year 2020

```{r}
northeastern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% northeastern)
northern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% northern)
western_lisa_2020 <- lisa_2020 %>% filter(province_en %in% western)
central_lisa_2020 <- lisa_2020 %>% filter(province_en %in% central)
eastern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% eastern)
southern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% southern)

northeastern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% northeastern)
northern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% northern)
western_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% western)
central_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% central)
eastern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% eastern)
southern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% southern)
```

### Northeastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northeastern_local <- tm_shape(northeastern_lisa_2020)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northeastern_sig <- tm_shape(northeastern_lisa_2020)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)
```

### Northern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northern_local <- tm_shape(northern_lisa_2020)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northern_sig <- tm_shape(northern_lisa_2020)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northern_local,northern_sig, asp=1, ncol=2)
```

### Western Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

western_local <- tm_shape(western_lisa_2020)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

western_sig <- tm_shape(western_lisa_2020)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(western_local,western_sig, asp=1, ncol=2)
```

### Central Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

central_local <- tm_shape(central_lisa_2020)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

central_sig <- tm_shape(central_lisa_2020)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(central_local,central_sig, asp=1, ncol=2)
```

### Eastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

eastern_local <- tm_shape(eastern_lisa_2020)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

eastern_sig <- tm_shape(eastern_lisa_2020)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)
```

### Southern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

southern_local <- tm_shape(southern_lisa_2020)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

southern_sig <- tm_shape(southern_lisa_2020)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(southern_local,southern_sig, asp=1, ncol=2)
```

### Analysis & Discussion

The central district

```{r}
#| code-fold: true
#| code-summary: "Show the code"

tm_shape(central_lisa_2020)+
  tm_polygons(id="label") +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(central_lisa_2020_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          id="label")+
  tm_borders(col = "black", alpha = 0.6)
```

## Year 2021

```{r}
northeastern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% northeastern)
northern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% northern)
western_lisa_2021 <- lisa_2021 %>% filter(province_en %in% western)
central_lisa_2021 <- lisa_2021 %>% filter(province_en %in% central)
eastern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% eastern)
southern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% southern)

northeastern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% northeastern)
northern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% northern)
western_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% western)
central_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% central)
eastern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% eastern)
southern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% southern)
```

### Northeastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northeastern_local <- tm_shape(northeastern_lisa_2021)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northeastern_sig <- tm_shape(northeastern_lisa_2021)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)
```

### Northern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northern_local <- tm_shape(northern_lisa_2021)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northern_sig <- tm_shape(northern_lisa_2021)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northern_local,northern_sig, asp=1, ncol=2)
```

### Western Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

western_local <- tm_shape(western_lisa_2021)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

western_sig <- tm_shape(western_lisa_2021)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(western_local,western_sig, asp=1, ncol=2)
```

### Central Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

central_local <- tm_shape(central_lisa_2021)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

central_sig <- tm_shape(central_lisa_2021)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(central_local,central_sig, asp=1, ncol=2)
```

### Eastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

eastern_local <- tm_shape(eastern_lisa_2021)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

eastern_sig <- tm_shape(eastern_lisa_2021)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)
```

### Southern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

southern_local <- tm_shape(southern_lisa_2021)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

southern_sig <- tm_shape(southern_lisa_2021)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(southern_local,southern_sig, asp=1, ncol=2)
```

### Analysis & Discussion

The central district

```{r}
#| code-fold: true
#| code-summary: "Show the code"

tm_shape(central_lisa_2021)+
  tm_polygons(id="label") +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(central_lisa_2021_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          id="label")+
  tm_borders(col = "black", alpha = 0.6)
```

## Year 2022

```{r}
northeastern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% northeastern)
northern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% northern)
western_lisa_2022 <- lisa_2022 %>% filter(province_en %in% western)
central_lisa_2022 <- lisa_2022 %>% filter(province_en %in% central)
eastern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% eastern)
southern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% southern)

northeastern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% northeastern)
northern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% northern)
western_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% western)
central_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% central)
eastern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% eastern)
southern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% southern)
```

### Northeastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northeastern_local <- tm_shape(northeastern_lisa_2022)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northeastern_sig <- tm_shape(northeastern_lisa_2022)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)
```

### Northern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

northern_local <- tm_shape(northern_lisa_2022)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

northern_sig <- tm_shape(northern_lisa_2022)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(northern_local,northern_sig, asp=1, ncol=2)
```

### Western Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

western_local <- tm_shape(western_lisa_2022)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

western_sig <- tm_shape(western_lisa_2022)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(western_local,western_sig, asp=1, ncol=2)
```

### Central Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

central_local <- tm_shape(central_lisa_2022)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

central_sig <- tm_shape(central_lisa_2022)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(central_local,central_sig, asp=1, ncol=2)
```

### Eastern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

eastern_local <- tm_shape(eastern_lisa_2022)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

eastern_sig <- tm_shape(eastern_lisa_2022)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)
```

### Southern Region

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

southern_local <- tm_shape(southern_lisa_2022)+
  tm_fill("ii", 
          palette = c("#e1ecbb","#f5f3a6", "#ec9a64","#de573e","#d21b1c"),
          title = "Local Moran's I",
          midpoint = NA) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level Spatial Autocorrelation \nof drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

southern_sig <- tm_shape(southern_lisa_2022)+
  tm_fill("p_ii_sim", 
          palette = c("#d21b1c","#ec9a64","#f5f3a6","#c9e3d2","#b7dce9"),
          n =5,
          title = "p-value",
          midpoint = 0.5) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Statistical Significance of Spatial Autocorrelation\n of drug use Cases in North District",
            main.title.position = "center",
            main.title.size = 1.3,
            main.title.fontface = "bold",
            legend.title.size = 1,
            legend.text.size = 0.8,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1) +
  tm_grid(labels.size = 1,alpha =0.2)

tmap_arrange(southern_local,southern_sig, asp=1, ncol=2)
```

### Analysis & Discussion

The central district

```{r}
#| code-fold: true
#| code-summary: "Show the code"

tm_shape(central_lisa_2022)+
  tm_polygons(id="label") +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(central_lisa_2022_sig)+
  tm_fill("ii", 
          palette = c("#b7dce9","#e1ecbb"),
          title = "Local Moran's I (p < 0.05)",
          midpoint = NA,
          id="label")+
  tm_borders(col = "black", alpha = 0.6)
```
:::

## 2.7.3 LISA Classification

the Local Indicator of Spatial Association (LISA) can provide insights into spatial clustering and outliers of drug-related incidents. Specifically, LISA identifies areas with significant spatial patterns, where the clustering of similar values occurs or where outliers stand out. This can help detect areas with unusually high or low concentrations of drug offenses.

Here’s how we can interpret the LISA classifications for drug use cases:

-   **High-Low Outliers**: Provinces with a high number of drug use cases surrounded by provinces with lower numbers. These could be hotspots of drug activity that differ significantly from their neighbors.

-   **Low-High Outliers**: Provinces with a low number of drug use cases, but surrounded by provinces with higher levels of drug offenses. This could indicate areas with protective factors or lower vulnerability, even though they are located near hotspots.

-   **High-High Clusters**: Provinces with a high concentration of drug use cases, surrounded by provinces that also have high numbers of offenses. This indicates regional hotspots of drug activity where intervention may be needed.

-   **Low-Low Clusters**: Provinces with a low number of drug use cases, surrounded by provinces with similarly low levels. These regions could represent areas with effective prevention measures or lower exposure to drug-related issues.

### 2.7.3 **Visualising Statistically Significant LISA Map for Study Area**

::: panel-tablet
## 2017

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| fig-width: 12
#| fig-height: 12

tmap_mode("plot")
study_area_lisa_2017 <- tm_shape(lisa_2017)+
  tm_polygons() +
  tm_borders(col = "black", alpha = 0.6)+
tm_shape(lisa_2017_sig)+
  tm_fill("mean", 
          palette = c("#b7dce9","#ec9a64","#e1ecbb", "#d21b1c"),
          title = "LISA class",
          midpoint = NA,
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_borders(col = "black", alpha = 0.6)+
  tm_layout(main.title = "Village-Level LISA Map of Drug Use cases in Thailand",
            main.title.position = "center",
            main.title.size = 1.7,
            main.title.fontface = "bold",
            legend.outside = TRUE,
            legend.outside.position = "right",
            legend.title.size = 1.8,
            legend.text.size = 1.3,
            frame = TRUE) +
  tm_borders(alpha = 0.5) +
  tm_compass(type="8star", text.size = 1.5, size = 2, position=c("RIGHT", "TOP")) +
  tm_scale_bar(position=c("LEFT", "BOTTOM"), text.size=1.2) +
  tm_grid(labels.size = 1,alpha =0.2)

study_area_lisa_2017
```
:::

```{}
```

:::
