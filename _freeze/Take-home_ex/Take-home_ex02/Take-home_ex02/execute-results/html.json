{
  "hash": "26693d572cc184b66d91d117456adfc5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 1: Geospatial Analytics for Social Good: Application of Spatial and Spatio-temporal Point Patterns Analysis to discover the geographical distribution of Armed Conflict in Myanmar\"\nauthor: \"Brian Lim\"\ndate: \"September 8, 2024\"\ndate-modified: \"last-modified\"\ncategories:\n  - Analysis\n  - R\n  - sf\n  - tidyverse\n  - spdep\n  - sfdep\nformat: html\neditor: visual\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n  cache.lazy: true\n---\n\n\n## 2.1 Exercise Overview\n\nDrug abuse is associated with profound health, financial, and social consequences, making it a critical global issue. Despite numerous efforts to combat the problem, illicit drug use remains highly prevalent, affecting millions of people worldwide. In 2021, it was estimated that 1 in 17 individuals aged 15–64 had used a drug in the past 12 months, with the total number of drug users rising from 240 million in 2011 to 296 million in 2021.\n\nThailand, in particular, is in a unique geopolitical position near the Golden Triangle of Indochina—the largest drug production site in Asia. This, combined with ongoing transportation infrastructure development, has made Thailand not only a significant market for drug consumption but also a critical transit route for drug trafficking to other countries. As a result, the nation faces a growing challenge in managing the social and health issues associated with drug abuse.\n\nAmong Thailand's youth population, drug abuse is a major social issue. With approximately 2.7 million youths involved in drug use, it is estimated that around 300,000 individuals aged between 15 and 19 require drug treatment. Alarmingly, drug involvement is particularly prevalent among vocational-school students, almost double that of secondary-school students, indicating that certain sub-populations may be at higher risk.\n\nGiven this context, the primary objective of this exercise is to explore whether key drug abuse indicators in Thailand are spatially independent or exhibit patterns of spatial dependence. Understanding these spatial dynamics is crucial for identifying clusters, outliers, and potential hotspots that can inform targeted interventions. Additionally, the temporal evolution of these spatial patterns from 2017 to 2022 will be analyzed to uncover trends and shifts over time.\n\nThis exercise aims to provide a comprehensive understanding of the spatial and temporal dynamics of drug abuse in Thailand. By identifying areas of concern and tracking their changes over time, the results can support policymakers and stakeholders in designing more effective, location-based strategies to mitigate the impact of drug abuse in the country.\n\n## 2.2 Data Acquisition\n\nFor the purpose of this take-home exercise, two data sets shall be used, they are: [Thailand Drug Offenses \\[2017-2022\\]](https://www.kaggle.com/datasets/thaweewatboy/thailand-drug-offenses-2017-2022) at Kaggle. [Thailand - Subnational Administrative Boundaries](https://data.humdata.org/dataset/cod-ab-tha?) at HDX. You are required to use the province boundary data set.\n\n## 2.3 Getting Started\n\nFor this exercise, the following R packages will be used:\n\n-   [**sf**](https://cran.r-project.org/web/packages/sf/) for handling geospatial data.\n\n-   [**spatstat**](https://spatstat.org/), a comprehensive package for point pattern analysis. We'll use it to perform first- and second-order spatial point pattern analyses and to derive kernel density estimation (KDE) layers.\n\n-   [**raster**](https://cran.r-project.org/web/packages/raster/), a package for reading, writing, manipulating, and modeling gridded spatial data (rasters). We will use it to convert image outputs generated by spatstat into raster format.\n\n-   [**tmap**](https://cran.r-project.org/web/packages/tmap/index.html), a package for creating high-quality static and interactive maps, leveraging the Leaflet API for interactive visualizations.\n\n-   [**tidyverse**](https://www.tidyverse.org/) for performing data science tasks such as importing, wrangling and visualising data.\n\n-   [**RColorBrewer**](https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf) for creating nice looking color palettes especially for thematic maps.\n\n-   [**spdep**](https://cran.r-project.org/web/packages/spdep/index.html) for spatial dependence analysis, including computing spatial weights and conducting spatial autocorrelation tests such as Moran's I and Geary's C\n\n-   [**sfdep**](https://cran.r-project.org/web/packages/sfdep/index.html) for computing spatial weights, global and local spatial autocorrelation statistics\n\n-   [**ggplot2**](https://cran.r-project.org/web/packages/ggplot2/index.html) for data visualization within the tidyverse. It will be used for creating a variety of plots, including temporal line charts and exploratory data visualizations that complement spatial maps\n\nAs readr, tidyr and dplyr are part of tidyverse package. The code chunk below will suffice to install and load the required packages in RStudio.\n\nTo install and load these packages into the R environment, we use the `p_load` function from the `pacman` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, raster, spatstat, tmap, tidyverse, RColorBrewer, spdep, sfdep, ggplot2)\n```\n:::\n\n\n## 2.4 Importing Data into R\n\nNext, we will import the `thai_drug_offenses_2017_2022.csv` file into the R environment and save it into an R dataframe called `acled_sf`. The task can be performed using the `read_csv()` function from the readr package, as shown below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_drug_offenses <- read.csv(\"data/archive/thai_drug_offenses_2017_2022.csv\")%>% \n  select(-province_th)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug_summary <- thai_drug_offenses %>%\n  group_by(fiscal_year, province_en, types_of_drug_offenses) %>%\n  summarize(no_cases = sum(no_cases, na.rm = TRUE), .groups = 'drop')\n```\n:::\n\n\n::: {.callout-tip title=\"Notes\"}\nWe used the `select()` function to ensure that the **province_th** column is not included in the dataframe.\n\nWe then perform summary operation on the `thai_drug_offenses` dataset:\n\n-   **Grouping**: The data is grouped by `fiscal_year`, `province_en`, and `types_of_drug_offenses`, which organizes the data by year, province, and type of drug offense.\n-   **Summarizing**: For each group, it calculates the total number of cases (`no_cases`) by summing them while ignoring any missing values (`na.rm = TRUE`).\n-   **Output**: The resulting `drug_summary` dataset will contain the summarized number of drug offense cases (`no_cases`) for each combination of year, province, and offense type.\n\nThe `.groups = 'drop'` argument ensures that the grouping is removed from the final summarized data.\n:::\n\nWe then import the boundaries and provinces of Thailand using the `st_read()` function to import the *tha_adm_rtsd_itos_20210121_shp* shapefile into R as a simple feature data frame named `regions_sf`. We also check the validity of the imported dataset, ensuring that it is in the right format with the `st_crs()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregions_sf <- st_read(dsn = \"data/tha_adm_rtsd_itos_20210121_shp\", \n                layer = \"tha_admbnda_adm1_rtsd_20220121\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `tha_admbnda_adm1_rtsd_20220121' from data source \n  `C:\\Users\\blzll\\OneDrive\\Desktop\\Y3S1\\IS415\\Quarto\\IS415\\Take-home_ex\\Take-home_ex02\\data\\tha_adm_rtsd_itos_20210121_shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 77 features and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nst_crs(regions_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n:::\n\n\n## 2.5 Data Wrangling\n\nBefore proceed we will do some **data wrangling**, this step primarily consist of checking for possible mismatches due to differences in the imported datasets. We will create a function to identify this.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to check province differences\nprov_diff <- function(thai_drug_offenses_provinces, regions_sf_provinces) {\n  # Create sets for efficient comparison\n  drug_set <- unique(thai_drug_offenses_provinces)\n  regions_set <- unique(regions_sf_provinces)\n  \n  # Check for mismatches\n  missing_in_regions <- setdiff(drug_set, regions_set)\n  missing_in_drug <- setdiff(regions_set, drug_set)\n  \n  if (length(missing_in_regions) == 0 && length(missing_in_drug) == 0) {\n    cat(\"All province names match.\\n\")\n  } else {\n    cat(\"There are mismatches in province names.\\n\")\n    if (length(missing_in_regions) > 0) {\n      cat(\"Missing in regions_sf:\", paste(missing_in_regions, collapse = \", \"), \"\\n\")\n    }\n    if (length(missing_in_drug) > 0) {\n      cat(\"Missing in drug_sf:\", paste(missing_in_drug, collapse = \", \"), \"\\n\")\n    }\n  }\n}\n\nprov_diff(unique(thai_drug_offenses$province_en), unique(regions_sf$ADM1_EN))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThere are mismatches in province names.\nMissing in regions_sf: Loburi, buogkan \nMissing in drug_sf: Lop Buri, Bueng Kan \n```\n\n\n:::\n:::\n\n\nBased on the derived results, we would need to reassign the misaligned values such that they match exactly. In the code chunk below, we will perform the reassignment in the regions_sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_drug_offenses <- thai_drug_offenses %>%\n  mutate(province_en = case_when(\n    province_en == \"Loburi\" ~ \"Lop Buri\",\n    province_en == \"buogkan\" ~ \"Bueng Kan\",\n    TRUE ~ province_en\n  ))\n\nprov_diff(unique(thai_drug_offenses$province_en), unique(regions_sf$ADM1_EN))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAll province names match.\n```\n\n\n:::\n:::\n\n\nWe will then join both datasets togther based on the **province_en** and **ADM1_EN** columns\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug_region_1 <- left_join(thai_drug_offenses, regions_sf, by = c(\"province_en\" = \"ADM1_EN\")) %>%\n  select(1:6, \"date\", \"geometry\")\n```\n:::\n\n\nWe then perform data validation checks on the newly created `drug_region_1` dataset, checking for missing values in key columns: `geometry`, `province_en`, `types_of_drug_offenses`, and `no_cases`. It uses the `summarise()` function to count how many `NA` values exist in each of these columns, helping to identify any incomplete or missing data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check for null values in key columns\nna_count <- drug_region_1 %>%\n  summarise(na_geometry = sum(is.na(geometry)),\n            na_province = sum(is.na(province_en)),\n            na_drug_offense = sum(is.na(types_of_drug_offenses)),\n            na_cases = sum(is.na(no_cases)))\n\nprint(na_count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  na_geometry na_province na_drug_offense na_cases\n1           0           0               0        0\n```\n\n\n:::\n:::\n\n\nWe then look for duplicate rows by grouping the data by `province_en`, `fiscal_year`, and `types_of_drug_offenses`. If any rows have the same combination of these fields (i.e., they are duplicates), they will be filtered and displayed; otherwise, a message indicating no duplicates will be printed. These steps ensure data quality before proceeding with any spatial or statistical analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicates <- drug_region_1 %>%\n  group_by(province_en, fiscal_year, types_of_drug_offenses) %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nif (nrow(duplicates) > 0) {\n  cat(\"Duplicates found:\\n\")\n  print(duplicates)\n} else {\n  cat(\"No duplicates found.\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNo duplicates found.\n```\n\n\n:::\n:::\n\n\nWe then ensure that `drug_region_1` is an `sf` object by using the `st_crs()` function, which returns the coordinate reference system (CRS) if the object is spatial, converting the `drug_region_1` data frame into an `sf` object using `st_as_sf()`, specifying EPSG:4326 as the CRS. This corresponds to the WGS 84 geographic coordinate system which is suitable for country of Thailand. This conversion is necessary to perform spatial analysis, as it ensures the dataset includes spatial information with proper geographic coordinates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# check if drug_region_1 is an sf object\nst_crs(drug_region_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System: NA\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert data frame to sf object and specify the CRS (EPSG:4326)\ndrug_region_thailand_sf <- st_as_sf(drug_region_1, crs = 4326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(drug_region_thailand_sf, \"data/rds/drug_region_thailand_sf.rds\")\ndrug_region_thailand_sf <- read_rds(\"data/rds/drug_region_thailand_sf.rds\")\n```\n:::\n\n\n## 2.6 Global Measures of Spatial Autocorrelation\n\nGlobal measures of spatial autocorrelation, such as Moran’s I and Geary’s C, are critical in understanding the overall spatial structure of geographic data. They help detect patterns of clustering or dispersion by assessing whether similar values occur near each other across an entire study area. This insight is essential for identifying spatial dependencies and guiding decisions in fields like epidemiology, economics, and environmental science. By quantifying spatial relationships on a broad scale, global measures provide a foundational perspective for spatial analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum_colors <- length(unique(regions_sf$ADM1_EN))\ncolors <- brewer.pal(n = num_colors, name = \"Set1\")\n\n# as there are 77 provinces in thailand\ntmap_options(max.categories = 77)\n\ntm_shape(regions_sf) +\n  tm_polygons(col = \"ADM1_EN\", palette = colors) +\n  tm_layout(main.title = \"Provinces in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.6,\n            legend.outside = TRUE) +\n  tm_legend(title = \"Provinces\")\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-12-1.png){width=1152}\n:::\n:::\n\n\n### 2.6.1 Defining Scope of Analysis\n\nTo ensure a data-driven analysis of drug-related offenses, we aim to focus exclusively on cases that have resulted in concrete legal outcomes, such as convictions or possession cases. cases based solely on suspicion may not lead to prosecution or final legal action, potentially inflating the data without accurately reflecting the true extent of confirmed criminal activity. By narrowing our scope to finalized or substantiated cases, we intend to provide more reliable insights into the patterns of drug-related crime and its impact.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Group by types_of_drug_offenses and summarize by summing the no_cases\ntop_drug_offenses <- thai_drug_offenses %>%\n  filter(!grepl(\"suspect\", types_of_drug_offenses, ignore.case = TRUE)) %>%\n  group_by(types_of_drug_offenses) %>%\n  summarise(total_cases = sum(no_cases, na.rm = TRUE)) %>%\n  arrange(desc(total_cases))\n\n# View non-suspicion based types of drug offenses\ntop_drug_offenses\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 2\n  types_of_drug_offenses                     total_cases\n  <chr>                                            <int>\n1 drug_use_cases                                  915529\n2 possession_cases                                538893\n3 possession_with_intent_to_distribute_cases      341283\n4 trafficking_cases                                68379\n5 production_cases                                 56892\n6 conspiracy_cases                                   920\n7 import_cases                                       860\n8 export_cases                                        84\n```\n\n\n:::\n:::\n\n\nWe are further refining our analysis exclusively on **drug use cases**. This choice is driven by the nature of these offenses, which represent direct instances of illicit drug consumption and are critical to understanding the broader context of drug-related issues in Thailand. Unlike cases that involve suspicion or potential possession, drug use cases have clear legal implications and societal impacts, making them essential for our analysis. By focusing solely on these confirmed instances, we aim to provide accurate insights into the patterns of drug use and its repercussions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrug_region_thailand_sf <- drug_region_thailand_sf %>% filter(types_of_drug_offenses == \"drug_use_cases\")\n```\n:::\n\n\nFocusing exclusively on drug use cases allows us to concentrate our efforts on a significant area of concern, thereby providing clearer recommendations for law enforcement and policy development. This targeted approach ensures that our insights align with the most impactful drug-related offenses, facilitating more effective interventions and resource allocation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregion_2017_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2017)\nregion_2018_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2018)\nregion_2019_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2019)\nregion_2020_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2020)\nregion_2021_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2021)\nregion_2022_sf <- drug_region_thailand_sf %>% filter(fiscal_year == 2022)\n```\n:::\n\n\n### 2.6.2 Computing Contiguity Neighbours\n\n#### Year 2017\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_nb_q <- st_contiguity(region_2017_sf, queen=TRUE)\nsummary(thailand_nb_q)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 352 \nPercentage nonzero weights: 5.93692 \nAverage number of links: 4.571429 \n1 region with no links:\n68\n2 disjoint connected subgraphs\nLink number distribution:\n\n 0  1  2  3  4  5  6  7  8  9 \n 1  1  5 17 15 17 10  5  4  2 \n1 least connected region:\n14 with 1 link\n2 most connected regions:\n28 48 with 9 links\n```\n\n\n:::\n:::\n\n\n1 region with no links can be observed in the summary above. This is due to the **island province of Phuket** having no direct land neighbours, and being connected to **Phangnga province** via a bridge. As such, we can manually assign **Phuket** a neighbor, **Phangnga**, to help avoid issues in the spatial analysis, particularly with Moran's I, which requires each region to have at least one neighbor.\n\nThe following code chunk finds the index positions of the provinces \"Phuket\" and \"Phangnga\" within the `region_2017_sf` spatial data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphuket_index <- which(region_2017_sf$province_en == \"Phuket\")\nphangnga_index <- which(region_2017_sf$province_en == \"Phangnga\")\n```\n:::\n\n\nPurpose: This code modifies the neighborhood relationship between \"Phuket\" and \"Phangnga\" by manually assigning them as neighbors to each other within the `thailand_nb_q` object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_nb_q[phuket_index][1] <- phangnga_index\nthailand_nb_q[phangnga_index][2] <- phuket_index\n```\n:::\n\n\nAs seen from the summary above all regions are linked and have at least 1 neighbour\n\n#### Computing Row-Standardised Weight Matrix\n\nNext, we need to assign spatial weights to each neighboring polygon.\n\n[`st_weights()`](https://rdrr.io/cran/sfdep/man/st_weights.html) function from `sfdep` packge can be used to supplement a neighbour list with spatial weights based on the chosen coding scheme. There are as least 5 different coding scheme styles supported by this function:\n\n-   `B` is the basic binary coding\n\n-   `W` is row standardised (sums over all links to n)\n\n-   `C` is globally standardised (sums over all links to n)\n\n-   `U` is equal to C divided by the number of neighbours (sums over all links to unity)\n\n-   `S` is the variance-stabilizing coding scheme proposed by Tiefelsdorf et al. (1999) (sums over all links to n).\n\nIn this study, we will use row-standardised weight matrix (style=`\"W\"`). Row standardisation of a matrix ensure that the sum of the values across each row add up to 1. This is accomplished by assigning the fraction 1/(# of neighbors) to each neighboring county then summing the weighted income values. Row standardisation ensures that all weights are between 0 and 1. This facilities the interpretation of operation with the weights matrix as an averaging of neighboring values, and allows for the spatial parameter used in our analyses to be comparable between models.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_wm_rs <- st_weights(thailand_nb_q, style = \"W\")\n```\n:::\n\n\nWe will mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2017_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_2017 <- region_2017_sf %>%\n  mutate(nb = thailand_nb_q,\n         wt = thailand_wm_rs,\n         .before = 1) \n```\n:::\n\n\n#### Global Moran's I\n\n::: panel-tabset\n## Global Moran's I\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoranI <- global_moran(wm_q_2017$no_cases,\n                        wm_q_2017$nb,\n                        wm_q_2017$wt)\nmoranI\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$I\n[1] 0.08216344\n\n$K\n[1] 30.4821\n```\n\n\n:::\n:::\n\n\n## Global Moran's I test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test_2017 <- global_moran_test(wm_q_2017$no_cases,\n                            wm_q_2017$nb,\n                            wm_q_2017$wt,\n                            alternative = \"greater\")\nglobal_moran_test_2017_statistics <- global_moran_test_2017$estimate[\"Moran I statistic\"]\nglobal_moran_test_2017_p_value <- global_moran_test_2017$p.value\nglobal_moran_test_2017\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw    \n\nMoran I statistic standard deviate = 1.5745, p-value = 0.05768\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.082163436      -0.013157895       0.003665038 \n```\n\n\n:::\n:::\n\n\nFor the year of **2017**, the Moran I statistic shows slight positive spatial autocorrelation, meaning there is some clustering of similar values of drug-related cases, but this clustering is weak and not statistically significant at the **5%** level (though close, with a p-value of **0.0577**). There is weak evidence suggesting that nearby provinces might have similar levels of drug-related cases, but the relationship is **not strong enough** to definitively **conclude spatial clustering**. As such, further investigation is needed to show stronger spatial autocorrelation.\n\n## Global Moran's I permutation test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\ngmoranMC_2017 <- global_moran_perm(wm_q_2017$no_cases,\n                  wm_q_2017$nb,\n                  wm_q_2017$wt,\n                  nsim = 999)\ngmoranMC_2017\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.082163, observed rank = 933, p-value = 0.134\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n:::\n\n#### Global Geary’s C\n\nIntroduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.\n\n::: panel-tabset\n## Global Geary's C test\n\nThe Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_c_test_2017 <- global_c_test(wm_q_2017$no_cases,\n                                    wm_q_2017$nb,\n                                    wm_q_2017$wt,\n                                    alternative = \"greater\")\nglobal_c_test_2017_statistics <- global_c_test_2017$estimate [\"Geary C statistic\"]\nglobal_c_test_2017_p_value <- global_c_test_2017$p.value\nglobal_c_test_2017\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tGeary C test under randomisation\n\ndata:  x \nweights: listw   \n\nGeary C statistic standard deviate = -0.17983, p-value = 0.5714\nalternative hypothesis: Expectation greater than statistic\nsample estimates:\nGeary C statistic       Expectation          Variance \n       1.02584500        1.00000000        0.02065461 \n```\n\n\n:::\n:::\n\n\n## Global Geary's C Permutation Test\n\nSimilar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nbperm_2017 <- global_c_perm(wm_q_2017$no_cases,\n                  wm_q_2017$nb,\n                  wm_q_2017$wt,\n                  nsim = 999)\nbperm_2017\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Geary C\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 1.0258, observed rank = 565, p-value = 0.565\nalternative hypothesis: greater\n```\n\n\n:::\n:::\n\n:::\n\n#### Year 2018\n\nSimilar that of 2017, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning \"Phuket\" and \"Phangnga\" as neighbours.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_nb_q <- st_contiguity(region_2018_sf, queen=TRUE)\n```\n:::\n\n\nThe following code chunk finds the index positions of the provinces \"Phuket\" and \"Phangnga\" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphuket_index <- which(region_2018_sf$province_en == \"Phuket\")\nphangnga_index <- which(region_2018_sf$province_en == \"Phangnga\")\n\nthailand_nb_q[phuket_index][1] <- phangnga_index\nthailand_nb_q[phangnga_index][2] <- phuket_index\n```\n:::\n\n\n#### Computing Row-Standardised Weight Matrix\n\nUsing the contiguity weight matrix, we will use row-standardised weight matrix (style = \"W\").\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_wm_rs <- st_weights(thailand_nb_q, style = \"W\")\n```\n:::\n\n\nWe then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_2018 <- region_2018_sf %>%\n  mutate(nb = thailand_nb_q,\n         wt = thailand_wm_rs,\n         .before = 1) \n```\n:::\n\n\n#### Global Moran's I\n\n::: panel-tabset\n## Global Moran's I\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoranI <- global_moran(wm_q_2018$no_cases,\n                        wm_q_2018$nb,\n                        wm_q_2018$wt)\nmoranI\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$I\n[1] 0.09520252\n\n$K\n[1] 27.02001\n```\n\n\n:::\n:::\n\n\n## Global Moran's I test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test_2018 <- global_moran_test(wm_q_2018$no_cases,\n                            wm_q_2018$nb,\n                            wm_q_2018$wt,\n                            alternative = \"greater\")\nglobal_moran_test_2018_statistics <- global_moran_test_2018$estimate[\"Moran I statistic\"]\nglobal_moran_test_2018_p_value <- global_moran_test_2018$p.value\nglobal_moran_test_2018\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw    \n\nMoran I statistic standard deviate = 1.7246, p-value = 0.0423\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.095202524      -0.013157895       0.003947668 \n```\n\n\n:::\n:::\n\n\nIn **2018**, the results of the Moran's I test reveal a slight positive spatial autocorrelation for drug-related cases in Thailand, indicated by a Moran I statistic of **0.0952**. This suggests that there is some degree of clustering among provinces with similar levels of drug-related incidents. However, the significance of this clustering is marginal, as evidenced by the p-value of **0.0423**, which is just below the conventional threshold of **0.05** for statistical significance.\n\nWhile the results imply a weak tendency for nearby provinces to exhibit similar drug-related case counts, the evidence is insufficient to draw definitive conclusions about robust spatial clustering. The expectation value of **-0.0132** and variance of **0.0039** further support the interpretation that, although there are clusters present, they do not exhibit a strong or clear pattern. This indicates a need for additional analyses or data to better understand the underlying dynamics of drug use in the region. Authorities may consider more detailed investigations to explore factors influencing these patterns, such as socio-economic conditions, access to treatment, or enforcement measures in surrounding areas.\n\n## Global Moran's I permutation test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\ngmoranMC_2018 <- global_moran_perm(wm_q_2018$no_cases,\n                  wm_q_2018$nb,\n                  wm_q_2018$wt,\n                  nsim = 999)\ngmoranMC_2018\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.095203, observed rank = 943, p-value = 0.114\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n:::\n\n#### Global Geary’s C\n\nIntroduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.\n\n::: panel-tabset\n## Global Geary's C test\n\nThe Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_c_test_2018 <- global_c_test(wm_q_2018$no_cases,\n                                    wm_q_2018$nb,\n                                    wm_q_2018$wt,\n                                    alternative = \"greater\")\nglobal_c_test_2018_statistics <- global_c_test_2018$estimate [\"Geary C statistic\"]\nglobal_c_test_2018_p_value <- global_c_test_2018$p.value\nglobal_c_test_2018\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tGeary C test under randomisation\n\ndata:  x \nweights: listw   \n\nGeary C statistic standard deviate = -0.026547, p-value = 0.5106\nalternative hypothesis: Expectation greater than statistic\nsample estimates:\nGeary C statistic       Expectation          Variance \n       1.00365196        1.00000000        0.01892375 \n```\n\n\n:::\n:::\n\n\n## Global Geary's C Permutation Test\n\nSimilar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nbperm_2018 <- global_c_perm(wm_q_2018$no_cases,\n                  wm_q_2018$nb,\n                  wm_q_2018$wt,\n                  nsim = 999)\nbperm_2018\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Geary C\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 1.0037, observed rank = 524, p-value = 0.524\nalternative hypothesis: greater\n```\n\n\n:::\n:::\n\n:::\n\n#### Year 2019\n\nSimilar that of the previous years, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning \"Phuket\" and \"Phangnga\" as neighbours.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_nb_q <- st_contiguity(region_2019_sf, queen=TRUE)\n```\n:::\n\n\nThe following code chunk finds the index positions of the provinces \"Phuket\" and \"Phangnga\" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphuket_index <- which(region_2019_sf$province_en == \"Phuket\")\nphangnga_index <- which(region_2019_sf$province_en == \"Phangnga\")\n\nthailand_nb_q[phuket_index][1] <- phangnga_index\nthailand_nb_q[phangnga_index][2] <- phuket_index\n```\n:::\n\n\n#### Computing Row-Standardised Weight Matrix\n\nUsing the contiguity weight matrix, we will use row-standardised weight matrix (style = \"W\").\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_wm_rs <- st_weights(thailand_nb_q, style = \"W\")\n```\n:::\n\n\nWe then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_2019 <- region_2019_sf %>%\n  mutate(nb = thailand_nb_q,\n         wt = thailand_wm_rs,\n         .before = 1) \n```\n:::\n\n\n#### Global Moran's I\n\n::: panel-tabset\n## Global Moran's I\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoranI <- global_moran(wm_q_2019$no_cases,\n                        wm_q_2019$nb,\n                        wm_q_2019$wt)\nmoranI\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$I\n[1] 0.1410203\n\n$K\n[1] 13.70039\n```\n\n\n:::\n:::\n\n\n## Global Moran's I test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test_2019 <- global_moran_test(wm_q_2019$no_cases,\n                            wm_q_2019$nb,\n                            wm_q_2019$wt,\n                            alternative = \"greater\")\nglobal_moran_test_2019_statistics <- global_moran_test_2019$estimate[\"Moran I statistic\"]\nglobal_moran_test_2019_p_value <- global_moran_test_2019$p.value\nglobal_moran_test_2019\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw    \n\nMoran I statistic standard deviate = 2.1728, p-value = 0.0149\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.141020279      -0.013157895       0.005035023 \n```\n\n\n:::\n:::\n\n\nIn **2019**, the results of the Moran's I test indicate a moderate positive spatial autocorrelation for drug-related cases in Thailand, reflected by a Moran I statistic of **0.1410**. This suggests a more pronounced clustering effect, where nearby provinces are likely to have similar levels of drug-related incidents.\n\nThe p-value of **0.0149** is statistically significant, indicating that the observed clustering is unlikely to be due to random chance at the **5%** significance level. This finding reinforces the notion that there are regions in Thailand where drug-related cases are concentrated, pointing to potential hotspots that may require targeted interventions.\n\n## Global Moran's I permutation test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\ngmoranMC_2019 <- global_moran_perm(wm_q_2019$no_cases,\n                  wm_q_2019$nb,\n                  wm_q_2019$wt,\n                  nsim = 999)\ngmoranMC_2019\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.14102, observed rank = 975, p-value = 0.05\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n:::\n\n#### Global Geary’s C\n\nIntroduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.\n\n::: panel-tabset\n## Global Geary's C test\n\nThe Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_c_test_2019 <- global_c_test(wm_q_2019$no_cases,\n                                    wm_q_2019$nb,\n                                    wm_q_2019$wt,\n                                    alternative = \"greater\")\nglobal_c_test_2019_statistics <- global_c_test_2019$estimate [\"Geary C statistic\"]\nglobal_c_test_2019_p_value <- global_c_test_2019$p.value\nglobal_c_test_2019\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tGeary C test under randomisation\n\ndata:  x \nweights: listw   \n\nGeary C statistic standard deviate = 0.7522, p-value = 0.226\nalternative hypothesis: Expectation greater than statistic\nsample estimates:\nGeary C statistic       Expectation          Variance \n       0.91669667        1.00000000        0.01226465 \n```\n\n\n:::\n:::\n\n\n## Global Geary's C Permutation Test\n\nSimilar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nbperm_2019 <- global_c_perm(wm_q_2019$no_cases,\n                  wm_q_2019$nb,\n                  wm_q_2019$wt,\n                  nsim = 999)\nbperm_2019\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Geary C\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.9167, observed rank = 204, p-value = 0.204\nalternative hypothesis: greater\n```\n\n\n:::\n:::\n\n:::\n\n#### Year 2020\n\nSimilar that of the previous years, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning \"Phuket\" and \"Phangnga\" as neighbours.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_nb_q <- st_contiguity(region_2020_sf, queen=TRUE)\n```\n:::\n\n\nThe following code chunk finds the index positions of the provinces \"Phuket\" and \"Phangnga\" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphuket_index <- which(region_2020_sf$province_en == \"Phuket\")\nphangnga_index <- which(region_2020_sf$province_en == \"Phangnga\")\n\nthailand_nb_q[phuket_index][1] <- phangnga_index\nthailand_nb_q[phangnga_index][2] <- phuket_index\n```\n:::\n\n\n#### Computing Row-Standardised Weight Matrix\n\nUsing the contiguity weight matrix, we will use row-standardised weight matrix (style = \"W\").\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_wm_rs <- st_weights(thailand_nb_q, style = \"W\")\n```\n:::\n\n\nWe then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_2020 <- region_2020_sf %>%\n  mutate(nb = thailand_nb_q,\n         wt = thailand_wm_rs,\n         .before = 1) \n```\n:::\n\n\n#### Global Moran's I\n\n::: panel-tabset\n## Global Moran's I\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoranI <- global_moran(wm_q_2020$no_cases,\n                        wm_q_2020$nb,\n                        wm_q_2020$wt)\nmoranI\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$I\n[1] 0.0874654\n\n$K\n[1] 10.43646\n```\n\n\n:::\n:::\n\n\n## Global Moran's I test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test_2020 <- global_moran_test(wm_q_2020$no_cases,\n                            wm_q_2020$nb,\n                            wm_q_2020$wt,\n                            alternative = \"greater\")\nglobal_moran_test_2020_statistics <- global_moran_test_2020$estimate[\"Moran I statistic\"]\nglobal_moran_test_2020_p_value <- global_moran_test_2020$p.value\nglobal_moran_test_2020\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw    \n\nMoran I statistic standard deviate = 1.382, p-value = 0.08349\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.087465400      -0.013157895       0.005301475 \n```\n\n\n:::\n:::\n\n\nFor the year **2020**, the results of the Moran's I test reveal a slight positive spatial autocorrelation for drug-related cases in Thailand, with a Moran I statistic of **0.0875**. This indicates that there is some level of clustering of similar values, although the strength of this clustering is weak.\n\nThe p-value of **0.08349** suggests that the observed spatial autocorrelation is not statistically significant at the conventional **5%** level, indicating that the clustering might be due to random chance rather than a definitive spatial pattern. Despite being close to significance, this p-value reflects uncertainty regarding the presence of meaningful spatial clusters.\n\nWith an expectation value of **-0.0132** and a variance of **0.0053**, the results imply that while there is a slight tendency for neighboring provinces to exhibit similar drug-related cases, the evidence is insufficient to draw strong conclusions about spatial clustering. Authorities may need to continue monitoring drug-related incidents in this year, as the potential for clustering exists, but further analysis and data may be required to identify any significant patterns or trends.\n\n## Global Moran's I permutation test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\ngmoranMC_2020 <- global_moran_perm(wm_q_2020$no_cases,\n                  wm_q_2020$nb,\n                  wm_q_2020$wt,\n                  nsim = 999)\ngmoranMC_2020\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.087465, observed rank = 903, p-value = 0.194\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n:::\n\n#### Global Geary’s C\n\nIntroduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.\n\n::: panel-tabset\n## Global Geary's C test\n\nThe Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_c_test_2020 <- global_c_test(wm_q_2020$no_cases,\n                                    wm_q_2020$nb,\n                                    wm_q_2020$wt,\n                                    alternative = \"greater\")\nglobal_c_test_2020_statistics <- global_c_test_2020$estimate [\"Geary C statistic\"]\nglobal_c_test_2020_p_value <- global_c_test_2020$p.value\nglobal_c_test_2020\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tGeary C test under randomisation\n\ndata:  x \nweights: listw   \n\nGeary C statistic standard deviate = 0.45817, p-value = 0.3234\nalternative hypothesis: Expectation greater than statistic\nsample estimates:\nGeary C statistic       Expectation          Variance \n       0.95275528        1.00000000        0.01063286 \n```\n\n\n:::\n:::\n\n\n## Global Geary's C Permutation Test\n\nSimilar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nbperm_2020 <- global_c_perm(wm_q_2020$no_cases,\n                  wm_q_2020$nb,\n                  wm_q_2020$wt,\n                  nsim = 999)\nbperm_2020\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Geary C\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.95276, observed rank = 308, p-value = 0.308\nalternative hypothesis: greater\n```\n\n\n:::\n:::\n\n:::\n\n#### Year 2021\n\nSimilar that of the previous years, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning \"Phuket\" and \"Phangnga\" as neighbours.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_nb_q <- st_contiguity(region_2021_sf, queen=TRUE)\n```\n:::\n\n\nThe following code chunk finds the index positions of the provinces \"Phuket\" and \"Phangnga\" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphuket_index <- which(region_2021_sf$province_en == \"Phuket\")\nphangnga_index <- which(region_2021_sf$province_en == \"Phangnga\")\n\nthailand_nb_q[phuket_index][1] <- phangnga_index\nthailand_nb_q[phangnga_index][2] <- phuket_index\n```\n:::\n\n\n#### Computing Row-Standardised Weight Matrix\n\nUsing the contiguity weight matrix, we will use row-standardised weight matrix (style = \"W\").\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_wm_rs <- st_weights(thailand_nb_q, style = \"W\")\n```\n:::\n\n\nWe then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_2021 <- region_2021_sf %>%\n  mutate(nb = thailand_nb_q,\n         wt = thailand_wm_rs,\n         .before = 1) \n```\n:::\n\n\n#### Global Moran's I\n\n::: panel-tabset\n## Global Moran's I\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoranI <- global_moran(wm_q_2021$no_cases,\n                        wm_q_2021$nb,\n                        wm_q_2021$wt)\nmoranI\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$I\n[1] 0.2012584\n\n$K\n[1] 4.710498\n```\n\n\n:::\n:::\n\n\n## Global Moran's I test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test_2021 <- global_moran_test(wm_q_2021$no_cases,\n                            wm_q_2021$nb,\n                            wm_q_2021$wt,\n                            alternative = \"greater\")\nglobal_moran_test_2021_statistics <- global_moran_test_2021$estimate[\"Moran I statistic\"]\nglobal_moran_test_2021_p_value <- global_moran_test_2021$p.value\nglobal_moran_test_2021\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw    \n\nMoran I statistic standard deviate = 2.823, p-value = 0.002379\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.201258399      -0.013157895       0.005768917 \n```\n\n\n:::\n:::\n\n\nFor the year **2021**, the results of the Moran's I test demonstrate a significant positive spatial autocorrelation for drug-related cases in Thailand, with a Moran I statistic of **0.2013**. This indicates a notable clustering of similar values, suggesting that provinces with higher drug-related cases are concentrated near each other.\n\nThe p-value of **0.002379** is highly significant, well below the conventional **5%** threshold, which provides strong evidence against the null hypothesis of randomness. This result suggests that the observed clustering is not likely to be due to chance, indicating a robust spatial pattern in drug-related incidents.\n\nWith an expectation value of **-0.0132** and a variance of **0.0058**, the findings imply a strong tendency for neighboring provinces to exhibit similar levels of drug-related cases. The identified clustering may warrant focused interventions and policy responses from authorities to address the growing concentration of drug-related issues in these regions. Such targeted strategies could be crucial in mitigating the potential escalation of drug-related activities in the identified hotspots.\n\n## Global Moran's I permutation test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\ngmoranMC_2021 <- global_moran_perm(wm_q_2021$no_cases,\n                  wm_q_2021$nb,\n                  wm_q_2021$wt,\n                  nsim = 999)\ngmoranMC_2021\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.20126, observed rank = 993, p-value = 0.014\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n:::\n\n#### Global Geary’s C\n\nIntroduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.\n\n::: panel-tabset\n## Global Geary's C test\n\nThe Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_c_test_2021 <- global_c_test(wm_q_2021$no_cases,\n                                    wm_q_2021$nb,\n                                    wm_q_2021$wt,\n                                    alternative = \"greater\")\nglobal_c_test_2021_statistics <- global_c_test_2021$estimate [\"Geary C statistic\"]\nglobal_c_test_2021_p_value <- global_c_test_2021$p.value\nglobal_c_test_2021\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tGeary C test under randomisation\n\ndata:  x \nweights: listw   \n\nGeary C statistic standard deviate = 1.7139, p-value = 0.04328\nalternative hypothesis: Expectation greater than statistic\nsample estimates:\nGeary C statistic       Expectation          Variance \n       0.84892396        1.00000000        0.00777019 \n```\n\n\n:::\n:::\n\n\n## Global Geary's C Permutation Test\n\nSimilar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nbperm_2021 <- global_c_perm(wm_q_2021$no_cases,\n                  wm_q_2021$nb,\n                  wm_q_2021$wt,\n                  nsim = 999)\nbperm_2021\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Geary C\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.84892, observed rank = 35, p-value = 0.035\nalternative hypothesis: greater\n```\n\n\n:::\n:::\n\n:::\n\n#### Year 2022\n\nSimilar that of the previous years, we will compute a contiguity weight matrix for the study area, assigning spatial weights to each neighboring polygon, while also manually assigning \"Phuket\" and \"Phangnga\" as neighbours.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_nb_q <- st_contiguity(region_2022_sf, queen=TRUE)\n```\n:::\n\n\nThe following code chunk finds the index positions of the provinces \"Phuket\" and \"Phangnga\" within the `region_2017_sf` spatial data frame, assigning them as neighbors to each other within the `thailand_nb_q` object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphuket_index <- which(region_2022_sf$province_en == \"Phuket\")\nphangnga_index <- which(region_2022_sf$province_en == \"Phangnga\")\n\nthailand_nb_q[phuket_index][1] <- phangnga_index\nthailand_nb_q[phangnga_index][2] <- phuket_index\n```\n:::\n\n\n#### Computing Row-Standardised Weight Matrix\n\nUsing the contiguity weight matrix, we will use row-standardised weight matrix (style = \"W\").\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthailand_wm_rs <- st_weights(thailand_nb_q, style = \"W\")\n```\n:::\n\n\nWe then mutate the newly created neighbour list object `thailand_nb_q` and weight matrix `thailand_wm_rs` into our existing `region_2018_sf`. The result will be a new object, which we will call `wm_q_<current-year>`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_2022 <- region_2022_sf %>%\n  mutate(nb = thailand_nb_q,\n         wt = thailand_wm_rs,\n         .before = 1) \n```\n:::\n\n\n#### Global Moran's I\n\n::: panel-tabset\n## Global Moran's I\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoranI <- global_moran(wm_q_2022$no_cases,\n                        wm_q_2022$nb,\n                        wm_q_2022$wt)\nmoranI\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$I\n[1] 0.2133052\n\n$K\n[1] 3.883933\n```\n\n\n:::\n:::\n\n\n## Global Moran's I test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test_2022 <- global_moran_test(wm_q_2022$no_cases,\n                            wm_q_2022$nb,\n                            wm_q_2022$wt,\n                            alternative = \"greater\")\nglobal_moran_test_2022_statistics <- global_moran_test_2022$estimate[\"Moran I statistic\"]\nglobal_moran_test_2022_p_value <- global_moran_test_2022$p.value\nglobal_moran_test_2022\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw    \n\nMoran I statistic standard deviate = 2.9643, p-value = 0.001517\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.213305190      -0.013157895       0.005836395 \n```\n\n\n:::\n:::\n\n\nFor the year **2022**, the Moran's I test results indicate a significant positive spatial autocorrelation in drug-related cases in Thailand, with a Moran I statistic of **0.2133**. This suggests a strong clustering of similar values, indicating that provinces with high rates of drug-related cases are likely situated near other high-rate provinces.\n\nThe p-value of **0.001517** is highly significant, well below the **5%** threshold, providing robust evidence against the null hypothesis of randomness. This strong clustering suggests that the pattern of drug-related incidents is not due to chance but rather reflects systematic geographical trends.\n\nWith an expectation value of **-0.0132** and a variance of **0.0058**, these findings underscore the importance of focusing intervention efforts on the identified clusters. The continued presence of significant spatial autocorrelation in drug-related cases across the years highlights the necessity for targeted policies and interventions in these areas to effectively address and mitigate the ongoing drug-related issues in Thailand.\n\n## Global Moran's I permutation test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\ngmoranMC_2022 <- global_moran_perm(wm_q_2022$no_cases,\n                  wm_q_2022$nb,\n                  wm_q_2022$wt,\n                  nsim = 999)\ngmoranMC_2022\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.21331, observed rank = 995, p-value = 0.01\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n:::\n\n#### Global Geary’s C\n\nIntroduced by Geary, Geary's C statistic studies the degree of intensity of a given feature in spatial objects described with the use of a weight matrix. Similarly to Moran's analysis, Geary's C can be used to quantify the extent of spatial autocorrelation in the data.\n\n::: panel-tabset\n## Global Geary's C test\n\nThe Global Geary's C test, which can be implemented using the `global_c_test()` function from the `sfdep` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_c_test_2022 <- global_c_test(wm_q_2022$no_cases,\n                                    wm_q_2022$nb,\n                                    wm_q_2022$wt,\n                                    alternative = \"greater\")\nglobal_c_test_2022_statistics <- global_c_test_2022$estimate [\"Geary C statistic\"]\nglobal_c_test_2022_p_value <- global_c_test_2022$p.value\nglobal_c_test_2022\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tGeary C test under randomisation\n\ndata:  x \nweights: listw   \n\nGeary C statistic standard deviate = 1.8924, p-value = 0.02922\nalternative hypothesis: Expectation greater than statistic\nsample estimates:\nGeary C statistic       Expectation          Variance \n      0.837683654       1.000000000       0.007356952 \n```\n\n\n:::\n:::\n\n\n## Global Geary's C Permutation Test\n\nSimilar to what we did in Moran's I test, we will use `global_c_perm()` function from **sfdep** package with `nsim = 999` which represent 1000 Monte Carlo simulations to be carried out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nbperm_2022 <- global_c_perm(wm_q_2022$no_cases,\n                  wm_q_2022$nb,\n                  wm_q_2022$wt,\n                  nsim = 999)\nbperm_2022\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Geary C\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.83768, observed rank = 27, p-value = 0.027\nalternative hypothesis: greater\n```\n\n\n:::\n:::\n\n:::\n\n### 2.6.3 Global Moran's I Permutation test\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# List of gmoranMC objects for each year\ngmoranMC_list <- list(gmoranMC_2017, gmoranMC_2018, gmoranMC_2019, \n                      gmoranMC_2020, gmoranMC_2021, gmoranMC_2022)\n\n# Corresponding year labels for the titles\nyear_labels <- c(\"2017\", \"2018\", \"2019\", \"2020\", \"2021\", \"2022\")\n\n# Set up the plotting area to have 3 rows and 2 columns for the six histograms\npar(mfrow = c(3, 2))\n\n# Loop through each year and plot the histogram\nfor (i in 1:length(gmoranMC_list)) {\n  gmoranMC <- gmoranMC_list[[i]]\n  year <- year_labels[i]\n  \n  # Plot the histogram for the current year\n  hist(gmoranMC$res, \n       main = paste(\"Global Moran's I MC Results\", year), \n       breaks = 20,\n       xlab = \"Monte-Carlo Results\", \n       ylab = \"Frequency\")\n  \n  # Add a vertical line for the observed Moran's I statistic\n  abline(v = gmoranMC$statistic, col = \"red\")\n}\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-71-1.png){width=1152}\n:::\n:::\n\n\n### 2.6.4 Global Geary's C Permutation test\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# List of bperm objects for each year\ngmoranMC_list <- list(bperm_2017, bperm_2018, bperm_2019, \n                      bperm_2020, bperm_2021, bperm_2022)\n\n# Corresponding year labels for the titles\nyear_labels <- c(\"2017\", \"2018\", \"2019\", \"2020\", \"2021\", \"2022\")\n\n# Set up the plotting area to have 3 rows and 2 columns for the six histograms\npar(mfrow = c(3, 2))\n\n# Loop through each year and plot the histogram\nfor (i in 1:length(gmoranMC_list)) {\n  gmoranMC <- gmoranMC_list[[i]]\n  year <- year_labels[i]\n  \n  # Plot the histogram for the current year\n  hist(gmoranMC$res, \n       main = paste(\"Global Moran's I MC Results\", year),\n       breaks = 20,\n       xlab = \"Monte-Carlo Results\", \n       ylab = \"Frequency\")\n  \n  # Add a vertical line for the observed Moran's I statistic\n  abline(v = gmoranMC$statistic, col = \"red\")\n}\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-72-1.png){width=1152}\n:::\n:::\n\n\n### 2.6.5 Temporal Trends (2017-2022)\n\nWe can then analyze the spatial patterns of drug-related cases in Thailand over the period from 2017 to 2022 using Moran’s I and Geary’s C global spatial autocorrelation tests. The Moran’s I statistic identifies whether similar case values are clustered across regions, while Geary’s C focuses on local-level similarity, both crucial in understanding the distribution of drug-related offenses over time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a data frame to store Moran's I statistics and p-values\nmoran_i_results <- data.frame(\n  Year = c(2017, 2018, 2019, 2020, 2021, 2022),\n  Moran_I_Stat = c(global_moran_test_2017_statistics, global_moran_test_2018_statistics,\n                   global_moran_test_2019_statistics, global_moran_test_2020_statistics,\n                   global_moran_test_2021_statistics, global_moran_test_2022_statistics),\n  Moran_I_p_value = c(global_moran_test_2017_p_value, global_moran_test_2018_p_value,\n                      global_moran_test_2019_p_value, global_moran_test_2020_p_value,\n                      global_moran_test_2021_p_value, global_moran_test_2022_p_value)\n)\n\n# Consolidate the Geary C test data into a data frame\ngeary_c_results <- data.frame(\n  Year = c(2017, 2018, 2019, 2020, 2021, 2022),\n  Geary_C_Stat = c(global_c_test_2017_statistics, global_c_test_2018_statistics, \n                   global_c_test_2019_statistics, global_c_test_2020_statistics, \n                   global_c_test_2021_statistics, global_c_test_2022_statistics),\n  Geary_C_p_value = c(global_c_test_2017_p_value, global_c_test_2018_p_value, \n                      global_c_test_2019_p_value, global_c_test_2020_p_value, \n                      global_c_test_2021_p_value, global_c_test_2022_p_value)\n)\n```\n:::\n\n\n::: {.callout-tip title=\"Notes\"}\n**Moran’s I (2017 - 2022)** 2017: Moran’s I = 0.0821, p-value = 0.0577 2018: Moran’s I = 0.0952, p-value = 0.0423 2019: Moran’s I = 0.1410, p-value = 0.0149 2020: Moran’s I = 0.0875, p-value = 0.0835 2021: Moran’s I = 0.2013, p-value = 0.0024 2022: Moran’s I = 0.2133, p-value = 0.0015\n\n**Geary’s C (2017 - 2022)** 2017: Geary’s C = 1.0258, p-value = 0.5714 2018: Geary’s C = 1.0037, p-value = 0.5106 2019: Geary’s C = 0.9167, p-value = 0.2260 2020: Geary’s C = 0.9528, p-value = 0.3234 2021: Geary’s C = 0.8489, p-value = 0.0433 2022: Geary’s C = 0.8377, p-value = 0.0292\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot Moran's I Statistic over the years\nggplot(moran_i_results, aes(x = Year, y = Moran_I_Stat)) +\n  geom_line() + \n  geom_point() +\n  labs(title = \"Moran's I Statistic Trend (2017-2022)\", \n       x = \"Year\", \n       y = \"Moran's I Statistic\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-74-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot p-values over the years\nggplot(moran_i_results, aes(x = Year, y = Moran_I_p_value)) +\n  geom_line() + \n  geom_point() +\n  geom_hline(yintercept = 0.05, linetype = \"dashed\", color = \"red\") +  # Significance threshold\n  labs(title = \"Moran's I Test p-values (2017-2022)\", \n       x = \"Year\", \n       y = \"p-value\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-75-1.png){width=672}\n:::\n:::\n\n\n::: {.callout-tip title=\"Reflection\"}\n**Moran’s I (2017 - 2022)**\n\n**2017**: Moran’s I = 0.0821, p-value = 0.0577\n\n**2018**: Moran’s I = 0.0952, p-value = 0.0423\n\n**2019**: Moran’s I = 0.1410, p-value = 0.0149\n\n**2020**: Moran’s I = 0.0875, p-value = 0.0835\n\n**2021**: Moran’s I = 0.2013, p-value = 0.0024\n\n**2022**: Moran’s I = 0.2133, p-value = 0.0015\n\n**Key Insights**:\n\n-   **2017–2019**: There is a gradual increase in spatial autocorrelation, with clustering becoming statistically significant by **2018** and peaking in **2019**.\n\n-   **2020**: A slight drop in Moran’s I indicates weaker spatial clustering, and the p-value suggests the autocorrelation is no longer significant. This could indicate that drug-related cases became more dispersed or random in 2020.\n\n-   **2021–2022**: A sharp rise in Moran’s I shows that spatial clustering of drug-related cases became very strong in these years, and it is statistically significant with p-values well below 0.05. Drug-related cases are now highly concentrated in certain areas.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot Geary C Statistic over the years\nggplot(geary_c_results, aes(x = Year, y = Geary_C_Stat)) +\n  geom_line() + \n  geom_point() +\n  labs(title = \"Geary C Statistic Trend (2017-2022)\", \n       x = \"Year\", \n       y = \"Geary C Statistic\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-76-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot p-values over the years\nggplot(geary_c_results, aes(x = Year, y = Geary_C_p_value)) +\n  geom_line() + \n  geom_point() +\n  geom_hline(yintercept = 0.05, linetype = \"dashed\", color = \"red\") +  # Mark significance threshold\n  labs(title = \"Geary C Test p-values (2017-2022)\", \n       x = \"Year\", \n       y = \"p-value\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-77-1.png){width=672}\n:::\n:::\n\n\n::: {.callout-tip title=\"Reflection\"}\n**Geary’s C (2017 - 2022)**\n\n**2017**: Geary’s C = 1.0258, p-value = 0.5714\n\n**2018**: Geary’s C = 1.0037, p-value = 0.5106\n\n**2019**: Geary’s C = 0.9167, p-value = 0.2260\n\n**2020**: Geary’s C = 0.9528, p-value = 0.3234\n\n**2021**: Geary’s C = 0.8489, p-value = 0.0433\n\n**2022**: Geary’s C = 0.8377, p-value = 0.0292\n\n**Key Insights**:\n\n-   **2017–2018**: Geary’s C values are very close to 1, indicating no significant spatial autocorrelation, meaning the distribution of drug-related cases was largely random.\n\n-   **2019**: The Geary’s C statistic starts to dip below 1, indicating emerging spatial autocorrelation, though it is not yet statistically significant.\n\n-   **2020**: Geary’s C rises slightly, indicating a slight weakening of spatial autocorrelation, but the cases are still mostly random with no significant clustering.\n\n-   **2021–2022**: A marked decrease in Geary’s C below 1, coupled with p-values dropping below 0.05, suggests significant clustering of similar values. This means that in the last two years, drug-related cases are no longer random and are now highly clustered.\n:::\n\n### 2.6.6 Conclusion\n\nFrom 2017 to 2022, both Moran’s I and Geary’s C statistics reveal an evolving spatial structure of drug-related cases. While earlier years exhibit weaker or random spatial patterns, by 2021 and 2022, significant clustering emerged, indicating an increase in spatial autocorrelation. This shift reflects that drug-related incidents are becoming more concentrated in specific areas, which could suggest targeted intervention zones for policy and law enforcement.\n\n## 2.7 Local Measures of Spatial Autocorrelation\n\nBuilding on the insights gained from global measures, local spatial autocorrelation focuses on identifying specific regions within the broader area that deviate from global trends. Techniques like **Local Moran’s I** allow for the detection of localized clusters and outliers, revealing spatial heterogeneity that might be masked by global statistics. This localized approach is crucial for pinpointing areas of high significance, enabling targeted interventions and more refined spatial decision-making.\n\n### 2.7.1 Local Moran's I\n\nFor each year from **2017 to 2022**, **Local Moran’s I** is calculated for each province in Thailand. This involves assessing the spatial autocorrelation of drug use cases, and for each year, a statistical test is performed with **99** simulations to generate a **p-value** for significance testing. Provinces with a **p-value** below 0.05 are considered statistically significant, and the resulting spatial autocorrelation patterns are visualized. The results for each year are presented using maps showing both **Local Moran’s I** values and their corresponding p-values, followed by a final map that highlights only statistically significant clusters `(p < 0.05)`. This iterative approach for multiple years enables the detection of persistent clusters of drug use cases across time, helping to identify long-term trends and regional patterns.\n\n::: panel-tabset\n## Year 2017\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nlisa_2017 <- wm_q_2017 %>% \n  mutate(local_moran = local_moran(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_2017\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 77 features and 21 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n# A tibble: 77 × 22\n       ii        eii var_ii    z_ii          p_ii p_ii_sim p_folded_sim skewness\n    <dbl>      <dbl>  <dbl>   <dbl>         <dbl>    <dbl>        <dbl>    <dbl>\n 1 -0.556 -0.726     3.18    0.0955 0.924             0.84         0.42     1.15\n 2  0.335  0.00121   0.110   1.01   0.314             0.06         0.03    -2.24\n 3 -0.652  0.0429    0.0203 -4.87   0.00000109        0.04         0.02    -2.46\n 4 -0.492 -0.0000714 0.0516 -2.17   0.0303            0.12         0.06    -2.22\n 5  0.171  0.00626   0.0340  0.892  0.372             0.3          0.15    -1.52\n 6  0.122 -0.00370   0.0132  1.09   0.276             0.06         0.03    -2.73\n 7 -0.929  0.00822   0.0243 -6.00   0.00000000192     0.02         0.01    -3.07\n 8  0.142 -0.00256   0.0784  0.516  0.606             0.58         0.29    -1.47\n 9  0.329  0.00292   0.0827  1.13   0.256             0.04         0.02    -1.99\n10  0.264  0.0694    0.0565  0.818  0.413             0.42         0.21    -2.03\n# ℹ 67 more rows\n# ℹ 14 more variables: kurtosis <dbl>, mean <fct>, median <fct>, pysal <fct>,\n#   nb <nb>, wt <list>, fiscal_year <int>, types_of_drug_offenses <chr>,\n#   no_cases <int>, province_en <chr>, Shape_Leng <dbl>, Shape_Area <dbl>,\n#   date <date>, geometry <MULTIPOLYGON [°]>\n```\n\n\n:::\n:::\n\n\n### Visualising Local Moran’s I_i\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2017)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Province-level Spatial Autocorrelation \\n of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-79-1.png){width=1152}\n:::\n:::\n\n\n### Visualising Local Moran’s I_i p-value\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2017)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#b7dce9\",\"#c9e3d2\",\"#f5f3a6\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"p-value\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial \\n Autocorrelation of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-80-1.png){width=1152}\n:::\n:::\n\n\n### Visualising Statistically Significant Local Spatial Autocorrelation Map\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlisa_2017_sig <- lisa_2017  %>%\n  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)\n\ntm_shape(lisa_2017)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2017_sig)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          title = \"Local Moran's I (p < 0.05)\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Village-Level Spatial \\n Autocorrelation Map of drug use cases \\n in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-81-1.png){width=1152}\n:::\n:::\n\n\n## Year 2018\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nlisa_2018 <- wm_q_2018 %>% \n  mutate(local_moran = local_moran(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_2018\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 77 features and 21 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n# A tibble: 77 × 22\n         ii       eii    var_ii   z_ii       p_ii p_ii_sim p_folded_sim skewness\n      <dbl>     <dbl>     <dbl>  <dbl>      <dbl>    <dbl>        <dbl>    <dbl>\n 1  0.192   -0.708    3.37       0.490    6.24e-1     0.62         0.31     1.16\n 2  0.358    0.00374  0.130      0.984    3.25e-1     0.16         0.08    -1.86\n 3 -0.188    0.0101   0.00188   -4.57     4.85e-6     0.04         0.02    -2.20\n 4 -0.0355   0.000684 0.000313  -2.04     4.11e-2     0.14         0.07    -2.21\n 5  0.0580   0.00852  0.0157     0.395    6.93e-1     0.84         0.42    -1.30\n 6  0.00332 -0.000511 0.0000984  0.387    6.99e-1     0.76         0.38    -2.42\n 7  1.74    -0.00597  0.122      5.00     5.82e-7     0.04         0.02     2.73\n 8 -0.0724  -0.0104   0.0568    -0.260    7.95e-1     0.64         0.32    -1.59\n 9  0.280    0.0107   0.0816     0.943    3.46e-1     0.22         0.11    -1.72\n10  0.178    0.0436   0.0545     0.573    5.66e-1     0.66         0.33    -1.63\n# ℹ 67 more rows\n# ℹ 14 more variables: kurtosis <dbl>, mean <fct>, median <fct>, pysal <fct>,\n#   nb <nb>, wt <list>, fiscal_year <int>, types_of_drug_offenses <chr>,\n#   no_cases <int>, province_en <chr>, Shape_Leng <dbl>, Shape_Area <dbl>,\n#   date <date>, geometry <MULTIPOLYGON [°]>\n```\n\n\n:::\n:::\n\n\n### Visualising Local Moran’s I_i\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2018)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Province-level Spatial Autocorrelation \\n of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-83-1.png){width=1440}\n:::\n:::\n\n\n### Visualising Local Moran’s I_i p-value\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2018)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#b7dce9\",\"#c9e3d2\",\"#f5f3a6\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"p-value\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial \\n Autocorrelation of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-84-1.png){width=1152}\n:::\n:::\n\n\n### Visualising Statistically Significant Local Spatial Autocorrelation Map\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlisa_2018_sig <- lisa_2018  %>%\n  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)\n\ntm_shape(lisa_2018)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2018_sig)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          title = \"Local Moran's I (p < 0.05)\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Village-Level Spatial \\n Autocorrelation Map of drug use cases \\n in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-85-1.png){width=1152}\n:::\n:::\n\n\n## Year 2019\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nlisa_2019 <- wm_q_2019 %>% \n  mutate(local_moran = local_moran(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_2019\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 77 features and 21 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n# A tibble: 77 × 22\n          ii       eii    var_ii    z_ii     p_ii p_ii_sim p_folded_sim skewness\n       <dbl>     <dbl>     <dbl>   <dbl>    <dbl>    <dbl>        <dbl>    <dbl>\n 1  0.341    -0.478    3.34       0.448  0.654        0.6          0.3     1.09 \n 2  0.306    -0.000190 0.0941     0.997  0.319        0.18         0.09   -1.30 \n 3 -0.371     0.0183   0.0126    -3.47   0.000528     0.06         0.03   -1.64 \n 4  0.216    -0.0101   0.0188     1.65   0.0991       0.18         0.09    1.64 \n 5 -0.0149   -0.00255  0.000641  -0.488  0.625        0.76         0.38    0.733\n 6 -0.000229 -0.000528 0.0000344  0.0510 0.959        0.9          0.45   -1.78 \n 7  2.73      0.00364  0.517      3.79   0.000154     0.04         0.02    1.67 \n 8 -0.270    -0.0190   0.0714    -0.938  0.348        0.3          0.15   -1.21 \n 9  0.318     0.0122   0.0941     0.998  0.318        0.2          0.1    -1.15 \n10  0.166     0.0420   0.107      0.379  0.704        0.94         0.47   -1.13 \n# ℹ 67 more rows\n# ℹ 14 more variables: kurtosis <dbl>, mean <fct>, median <fct>, pysal <fct>,\n#   nb <nb>, wt <list>, fiscal_year <int>, types_of_drug_offenses <chr>,\n#   no_cases <int>, province_en <chr>, Shape_Leng <dbl>, Shape_Area <dbl>,\n#   date <date>, geometry <MULTIPOLYGON [°]>\n```\n\n\n:::\n:::\n\n\n### Visualising Local Moran’s I_i\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2019)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Province-level Spatial Autocorrelation \\n of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-87-1.png){width=1440}\n:::\n:::\n\n\n### Visualising Local Moran’s I_i p-value\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2019)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#b7dce9\",\"#c9e3d2\",\"#f5f3a6\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"p-value\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial \\n Autocorrelation of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-88-1.png){width=1152}\n:::\n:::\n\n\n### Visualising Statistically Significant Local Spatial Autocorrelation Map\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlisa_2019_sig <- lisa_2019  %>%\n  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)\n\ntm_shape(lisa_2019)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2019_sig)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          title = \"Local Moran's I (p < 0.05)\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Village-Level Spatial \\n Autocorrelation Map of drug use cases \\n in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-89-1.png){width=1152}\n:::\n:::\n\n\n## Year 2020\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nlisa_2020 <- wm_q_2020 %>% \n  mutate(local_moran = local_moran(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_2020\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 77 features and 21 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n# A tibble: 77 × 22\n        ii       eii   var_ii    z_ii  p_ii p_ii_sim p_folded_sim skewness\n     <dbl>     <dbl>    <dbl>   <dbl> <dbl>    <dbl>        <dbl>    <dbl>\n 1 -0.0216 -0.0130   0.0485   -0.0392 0.969     0.82         0.41   -0.977\n 2 -0.0896 -0.0233   0.0160   -0.524  0.600     0.76         0.38    0.955\n 3 -0.0366 -0.000725 0.00435  -0.543  0.587     0.84         0.42    0.587\n 4  0.0565 -0.0138   0.0512    0.310  0.756     0.9          0.45   -0.699\n 5  0.0349 -0.0253   0.0500    0.269  0.788     0.92         0.46   -0.821\n 6  0.0160  0.000767 0.000482  0.692  0.489     0.6          0.3    -0.828\n 7 -0.121   0.0814   0.240    -0.413  0.680     0.54         0.27   -1.55 \n 8  0.0184 -0.000515 0.00185   0.441  0.659     0.86         0.43   -1.19 \n 9  1.52    0.0979   1.16      1.32   0.188     0.26         0.13    1.48 \n10  0.325  -0.106    1.30      0.377  0.706     0.62         0.31    0.841\n# ℹ 67 more rows\n# ℹ 14 more variables: kurtosis <dbl>, mean <fct>, median <fct>, pysal <fct>,\n#   nb <nb>, wt <list>, fiscal_year <int>, types_of_drug_offenses <chr>,\n#   no_cases <int>, province_en <chr>, Shape_Leng <dbl>, Shape_Area <dbl>,\n#   date <date>, geometry <MULTIPOLYGON [°]>\n```\n\n\n:::\n:::\n\n\n### Visualising Local Moran’s I_i\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2020)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Province-level Spatial Autocorrelation \\n of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-91-1.png){width=1440}\n:::\n:::\n\n\n### Visualising Local Moran’s I_i p-value\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2020)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#b7dce9\",\"#c9e3d2\",\"#f5f3a6\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"p-value\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial \\n Autocorrelation of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-92-1.png){width=1152}\n:::\n:::\n\n\n### Visualising Statistically Significant Local Spatial Autocorrelation Map\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlisa_2020_sig <- lisa_2020  %>%\n  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)\n\ntm_shape(lisa_2020)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2020_sig)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          title = \"Local Moran's I (p < 0.05)\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Village-Level Spatial \\n Autocorrelation Map of drug use cases \\n in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-93-1.png){width=1152}\n:::\n:::\n\n\n## Year 2021\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\nlisa_2021 <- wm_q_2021 %>% \n  mutate(local_moran = local_moran(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_2021\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 77 features and 21 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n# A tibble: 77 × 22\n        ii      eii  var_ii   z_ii   p_ii p_ii_sim p_folded_sim skewness\n     <dbl>    <dbl>   <dbl>  <dbl>  <dbl>    <dbl>        <dbl>    <dbl>\n 1  0.792   0.0225  0.159    1.93  0.0535     0.02         0.01   -0.447\n 2  0.0221 -0.00327 0.00190  0.581 0.561      0.6          0.3     0.601\n 3 -0.150   0.0186  0.0389  -0.858 0.391      0.38         0.19   -0.813\n 4  0.294   0.0143  0.0412   1.38  0.169      0.06         0.03   -0.960\n 5  0.118   0.0250  0.0245   0.594 0.553      0.6          0.3    -0.651\n 6 -0.321  -0.0164  0.0243  -1.96  0.0501     0.14         0.07   -0.681\n 7  0.0681 -0.0366  0.131    0.289 0.773      0.82         0.41   -0.675\n 8  0.718   0.0329  0.191    1.57  0.117      0.06         0.03   -0.554\n 9  0.635  -0.0222  0.276    1.25  0.211      0.18         0.09   -0.582\n10 -0.125  -0.00554 0.0230  -0.790 0.429      0.36         0.18   -0.886\n# ℹ 67 more rows\n# ℹ 14 more variables: kurtosis <dbl>, mean <fct>, median <fct>, pysal <fct>,\n#   nb <nb>, wt <list>, fiscal_year <int>, types_of_drug_offenses <chr>,\n#   no_cases <int>, province_en <chr>, Shape_Leng <dbl>, Shape_Area <dbl>,\n#   date <date>, geometry <MULTIPOLYGON [°]>\n```\n\n\n:::\n:::\n\n\n### Visualising Local Moran’s I_i\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2021)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Province-level Spatial Autocorrelation \\n of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-95-1.png){width=1440}\n:::\n:::\n\n\n### Visualising Local Moran’s I_i p-value\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2021)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#b7dce9\",\"#c9e3d2\",\"#f5f3a6\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"p-value\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial \\n Autocorrelation of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-96-1.png){width=1152}\n:::\n:::\n\n\n### Visualising Statistically Significant Local Spatial Autocorrelation Map\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlisa_2021_sig <- lisa_2021  %>%\n  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)\n\ntm_shape(lisa_2021)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2021_sig)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          title = \"Local Moran's I (p < 0.05)\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Village-Level Spatial \\n Autocorrelation Map of drug use cases \\n in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-97-1.png){width=1152}\n:::\n:::\n\n\n## Year 2022\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_2022 <- wm_q_2022 %>% \n  mutate(local_moran = local_moran(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_2022\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 77 features and 21 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n# A tibble: 77 × 22\n         ii      eii  var_ii    z_ii    p_ii p_ii_sim p_folded_sim skewness\n      <dbl>    <dbl>   <dbl>   <dbl>   <dbl>    <dbl>        <dbl>    <dbl>\n 1 -0.495    0.0371  0.364   -0.882  0.378       0.36         0.18   -0.139\n 2 -0.285    0.0270  0.169   -0.758  0.449       0.46         0.23    0.419\n 3  0.0512   0.00125 0.00556  0.670  0.503       0.56         0.28   -0.435\n 4  2.11    -0.00674 0.596    2.75   0.00605     0.02         0.01    0.336\n 5  0.860    0.0412  0.142    2.17   0.0300      0.02         0.01   -0.661\n 6  1.43    -0.0541  0.462    2.18   0.0293      0.04         0.02    0.222\n 7 -0.00992 -0.0333  0.0286   0.138  0.890       0.88         0.44   -0.144\n 8 -0.00621 -0.00279 0.00210 -0.0747 0.940       0.96         0.48   -0.367\n 9  0.0762   0.0177  0.402    0.0922 0.927       0.98         0.49    0.327\n10  0.672    0.0326  0.207    1.41   0.159       0.16         0.08   -0.388\n# ℹ 67 more rows\n# ℹ 14 more variables: kurtosis <dbl>, mean <fct>, median <fct>, pysal <fct>,\n#   nb <nb>, wt <list>, fiscal_year <int>, types_of_drug_offenses <chr>,\n#   no_cases <int>, province_en <chr>, Shape_Leng <dbl>, Shape_Area <dbl>,\n#   date <date>, geometry <MULTIPOLYGON [°]>\n```\n\n\n:::\n:::\n\n\n### Visualising Local Moran’s I_i\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2022)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Province-level Spatial Autocorrelation \\n of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-99-1.png){width=1440}\n:::\n:::\n\n\n### Visualising Local Moran’s I_i p-value\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntm_shape(lisa_2022)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#b7dce9\",\"#c9e3d2\",\"#f5f3a6\",\"#ec9a64\",\"#d21b1c\"),\n          title = \"p-value\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial \\n Autocorrelation of drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-100-1.png){width=1152}\n:::\n:::\n\n\n### Visualising Statistically Significant Local Spatial Autocorrelation Map\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlisa_2022_sig <- lisa_2022  %>%\n  filter(p_ii_sim < 0.05) %>% mutate(label = province_en)\n\ntm_shape(lisa_2022)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2022_sig)+\n  tm_fill(\"ii\", \n          palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                      \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          title = \"Local Moran's I (p < 0.05)\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Village-Level Spatial \\n Autocorrelation Map of drug use cases \\n in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-101-1.png){width=1152}\n:::\n:::\n\n:::\n\n### 2.7.2 Statistically Significant Local Spatial Autocorrelation Map (2017 - 2022)\n\nWe now try to get a detailed view of spatial clusters and outliers in drug use cases across Thailand over a six-year period **(2017 - 2022)**. These maps use **Local Moran’s I** to detect localized spatial patterns of drug use incidents, identifying regions where there is a statistically significant concentration of high or low case counts compared to neighboring provinces. Each year, the statistically significant clusters (p \\< 0.05) are highlighted using a color-coded palette that distinguishes between hotspots (areas with high case counts surrounded by similarly high values) and cold spots (areas with low case counts surrounded by low values). By focusing on these spatial patterns, the maps help to uncover specific provinces that either contribute to or deviate from the broader regional trends.\n\nUltimately, this yearly comparisons aims to allow researchers and policymakers to observe how the spatial distribution of drug-related incidents changes over time. The maps serve as a critical tool for identifying regions where drug use clusters persist or evolve, offering insights into areas that may require targeted interventions. By visualizing the significant local spatial autocorrelation for each year, these maps reveal temporal dynamics, enabling a deeper understanding of the spatial heterogeneity in drug use cases across Thailand.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# List of data for each year\nlisa_data <- list(\n  \"2017\" = list(lisa = lisa_2017, sig = lisa_2017_sig),\n  \"2018\" = list(lisa = lisa_2018, sig = lisa_2018_sig),\n  \"2019\" = list(lisa = lisa_2019, sig = lisa_2019_sig),\n  \"2020\" = list(lisa = lisa_2020, sig = lisa_2020_sig),\n  \"2021\" = list(lisa = lisa_2021, sig = lisa_2021_sig),\n  \"2022\" = list(lisa = lisa_2022, sig = lisa_2022_sig)\n)\n\n# Initialize an empty list to store tmap objects\nmaps <- list()\n\n# Loop through each year's data and create a map\nfor (year in names(lisa_data)) {\n  map <- tm_shape(lisa_data[[year]]$lisa) +\n    tm_polygons(id = \"label\") +\n    tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(lisa_data[[year]]$sig) +\n    tm_fill(\"ii\", \n            palette = c(\"#b7dce9\",\"#e1ecbb\",\"#f5f3a6\",\n                        \"#f8d887\",\"#ec9a64\",\"#d21b1c\"),\n            breaks = c(0, 0.001, 0.01, 0.05, 1),\n            labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n            title = paste(\"Local Moran's I\", year, \"(p < 0.05)\"),\n            midpoint = NA,\n            id = \"label\") +\n    tm_borders(col = \"black\", alpha = 0.6) +\n    # Add title to individual plot\n    tm_layout(title = paste(\"Year\", year), title.position = c(\"center\", \"top\"))\n  \n  # Store the map in the list\n  maps[[year]] <- map\n}\n\n# Arrange the maps side by side\ntmap_arrange(\n  maps$`2017`, maps$`2018`, maps$`2019`,\n  maps$`2020`, maps$`2021`, maps$`2022`,\n  ncol = 3\n)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-102-1.png){width=1152}\n:::\n:::\n\n\n### 2.7.3 Visualising Statistically Significant Local Spatial Autocorrelation Map\n\nThe Local Indicator of Spatial Association (LISA) can provide insights into spatial clustering and outliers of drug-related incidents. Specifically, LISA identifies areas with significant spatial patterns, where the clustering of similar values occurs or where outliers stand out. This can help detect areas with unusually high or low concentrations of drug offenses.\n\nHere’s how we can interpret the LISA classifications for drug use cases:\n\n-   **High-Low Outliers**: Provinces with a high number of drug use cases surrounded by provinces with lower numbers. These could be hotspots of drug activity that differ significantly from their neighbors.\n\n-   **Low-High Outliers**: Provinces with a low number of drug use cases, but surrounded by provinces with higher levels of drug offenses. This could indicate areas with protective factors or lower vulnerability, even though they are located near hotspots.\n\n-   **High-High Clusters**: Provinces with a high concentration of drug use cases, surrounded by provinces that also have high numbers of offenses. This indicates regional hotspots of drug activity where intervention may be needed.\n\n-   **Low-Low Clusters**: Provinces with a low number of drug use cases, surrounded by provinces with similarly low levels. These regions could represent areas with effective prevention measures or lower exposure to drug-related issues.\n\nIn each year's `lisa` sf data.frame that we created when calculating local Moran’s I, we can find three fields contain the LISA categories. They are `mean`, `median` and `pysal`. We will use mean column to visualise LISA classification maps with relevant tmap functions.\n\n#### 2.7.3.1 Country-wide view\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntmap_mode(\"plot\")\nstudy_area_lisa_2017 <- tm_shape(lisa_2017)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2017_sig)+\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2017 Thai LISA map\",\n            main.title.size = 1,\n            legend.outside = TRUE,\n            legend.outside.position = \"right\",\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nstudy_area_lisa_2018 <- tm_shape(lisa_2018)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2018_sig)+\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2018 Thai LISA map\",\n            main.title.size = 1,\n            legend.outside = TRUE,\n            legend.outside.position = \"right\",\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nstudy_area_lisa_2019 <- tm_shape(lisa_2019)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2019_sig)+\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2019 Thai LISA map\",\n            main.title.size = 1,\n            legend.outside = TRUE,\n            legend.outside.position = \"right\",\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nstudy_area_lisa_2020 <- tm_shape(lisa_2020)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2020_sig)+\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2020 Thai LISA map\",\n            main.title.size = 1,\n            legend.outside = TRUE,\n            legend.outside.position = \"right\",\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nstudy_area_lisa_2021 <- tm_shape(lisa_2021)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2021_sig)+\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2021 Thai LISA map\",\n            main.title.size = 1,\n            legend.outside = TRUE,\n            legend.outside.position = \"right\",\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nstudy_area_lisa_2022 <- tm_shape(lisa_2022)+\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6)+\ntm_shape(lisa_2022_sig)+\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2022 Thai LISA map\",\n            main.title.size = 1,\n            legend.outside = TRUE,\n            legend.outside.position = \"right\",\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n:::\n\n\n::: panel-tabset\n## Year 2017\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudy_area_lisa_2017\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-104-1.png){width=672}\n:::\n:::\n\n\n## Year 2018\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudy_area_lisa_2018\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-105-1.png){width=672}\n:::\n:::\n\n\n## Year 2019\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudy_area_lisa_2019\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-106-1.png){width=672}\n:::\n:::\n\n\n## Year 2020\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudy_area_lisa_2020\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-107-1.png){width=672}\n:::\n:::\n\n\n## Year 2021\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudy_area_lisa_2021\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-108-1.png){width=672}\n:::\n:::\n\n\n## Year 2022\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudy_area_lisa_2022\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-109-1.png){width=672}\n:::\n:::\n\n:::\n\nOn a national scale, provinces, especially smaller ones, may appear too small to analyze effectively, making it difficult to clearly see the distribution of the LISA classifications. A regional view, with better zoom and focus, can improve the clarity of visualization. It becomes easier to distinguish between clusters and outliers, especially in densely populated or small-area provinces.\n\n#### 2.7.3.2 Regional view\n\nThailand is variably divided into different sets of regions, the most notable of which are the six-region grouping used in geographic studies, and the four-region grouping consistent with the Monthon administrative regional grouping system formerly used by the Ministry of Interior. These regions are the largest subdivisions of the country.\n\nIn contrast to the administrative divisions of the provinces of Thailand, the regions no longer have an administrative character, but are used for statistical or academic purposes.\n\nA six-region system is commonly used for geographical and scientific purposes. This system dates to 1935. It was formalised in 1977 by the National Geographical Committee, which was appointed by the National Research Council. It divides the country into the following regions:\n\n-   Northern Thailand\n-   Northeastern Thailand\n-   Western Thailand\n-   Central Thailand\n-   Eastern Thailand\n-   Southern Thailand\n\nThe four-region system, used in some administrative and statistical contexts, and also as a loose cultural grouping, includes the western and eastern regions within the central region, while grouping the provinces of Sukhothai, Phitsanulok, Phichit, Kamphaeng Phet, Phetchabun, Nakhon Sawan, and Uthai Thani in the northern region. This is also the regional system most commonly used on national television, when discussing regional events. It divides the country into the following regions:\n\n-   Northern Thailand\n-   Northeastern Thailand (Isan)\n-   Central Thailand\n-   Southern Thailand\n\nThe Thai Meteorological Department divides the country into six regions for meteorological purposes. It differs from the four-region system in that the east is regarded as a separate region, the south is divided into east and west coasts, and Nakhon Sawan and Uthai Thani are grouped in the central region.\n\n![](image/distribution.png)\n\n::: {.callout-tip title=\"Notes\"}\nLISA relies on the spatial relationships between neighboring areas. If you remove certain provinces from the analysis when zooming into a region, the LISA statistics could change due to the loss of spatial context. To maintain the integrity of LISA classifications in a regional view, we will ensure that the entire neighborhood structure is still considered. Even though you may only visualize a specific region, the calculations should still include all neighboring provinces, not just those within the selected region.\n\nIt is important to keep the spatial dependencies intact by including all neighboring provinces in the LISA calculations. This ensures that the regional LISA classifications remain consistent with the national analysis, and the spatial clustering or outlier detection is not compromised due to changes in the geographical scope. The regional view should be treated as a zoomed-in perspective of the national LISA results, without altering the underlying spatial relationships.\n:::\n\nGiven the geographical scope of the study, we will adopt a six-region geographical distribution, focusing on the provincial level. This approach not only allows for a regionally nuanced analysis but also reduces the computational load within the R environment, making the analysis more efficient.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define provinces for each region\nnortheastern <- c(\"Amnat Charoen\", \"Bueng Kan\", \"Buri Ram\", \"Chaiyaphum\", \"Kalasin\", \n                  \"Khon Kaen\", \"Loei\", \"Maha Sarakham\", \"Mukdahan\", \"Nakhon Phanom\", \n                  \"Nakhon Ratchasima\", \"Nong Bua Lam Phu\", \"Nong Khai\", \"Roi Et\", \n                  \"Sakon Nakhon\", \"Si Sa Ket\", \"Surin\", \"Ubon Ratchathani\", \"Udon Thani\", \n                  \"Yasothon\")\n\nnorthern <- c(\"Chiang Mai\", \"Chiang Rai\", \"Lampang\", \"Lamphun\", \"Mae Hong Son\", \n              \"Nan\", \"Phayao\", \"Phrae\", \"Uttaradit\")\n\nwestern <- c(\"Tak\", \"Kanchanaburi\", \"Ratchaburi\", \"Phetchaburi\", \"Prachuap Khiri Khan\")\n\ncentral <- c(\"Kamphaeng Phet\", \"Phetchabun\", \"Phichit\", \"Phitsanulok\", \"Sukhothai\", \n             \"Nakhon Sawan\", \"Uthai Thani\", \"Ang Thong\", \"Bangkok\", \"Chai Nat\", \n             \"Lop Buri\", \"Nakhon Pathom\", \"Nonthaburi\", \"Pathum Thani\", \n             \"Phra Nakhon Si Ayutthaya\", \"Samut Prakan\", \"Samut Sakhon\", \n             \"Samut Songkhram\", \"Saraburi\", \"Sing Buri\", \"Suphan Buri\", \"Nakhon Nayok\")\n\neastern <- c(\"Chachoengsao\", \"Chanthaburi\", \"Chon Buri\", \"Prachin Buri\", \"Rayong\", \n             \"Sa Kaeo\", \"Trat\")\n\nsouthern <- c(\"Chumphon\", \"Nakhon Si Thammarat\", \"Narathiwat\", \"Pattani\", \n              \"Phatthalung\", \"Songkhla\", \"Surat Thani\", \"Yala\", \"Krabi\", \n              \"Phangnga\", \"Phuket\", \"Ranong\", \"Satun\", \"Trang\")\n```\n:::\n\n\nUsing a combination of the **Local Moran’s I** plot, which visualizes the degree of spatial autocorrelation, and the **p-value** plot, which highlights statistically significant areas, we can gain deeper insights into the spatial dynamics of drug use incidents within the region. This dual visualization approach ensures that identified patterns are both meaningful and reliable, allowing for more informed decision-making in policy development and resource allocation to tackle drug-related issues in specific regions.\n\n::: {.callout-tip title=\"Notes\"}\nThe **Local Moran's I plot** and the **p-value** of Local Moran's I plot work together to help identify significant spatial patterns in the distribution of drug use cases across regions. The Local Moran's I plot shows the degree of spatial autocorrelation, indicating where clusters of similar values (either high or low) occur. This plot helps highlight potential hotspots (high values surrounded by high values) or cold spots (low values surrounded by low values), as well as potential outliers (where high values are surrounded by low values or vice versa).\n\nHowever, the Local Moran's I values alone do not indicate whether these patterns are statistically significant. This is where the p-value of Local Moran’s I plot comes into play. It shows the significance levels of the spatial patterns, with red areas indicating highly significant clusters and blue/green areas representing non-significant patterns. This plot helps validate whether the clusters or outliers seen in the Local Moran’s I plot are meaningful or if they occurred randomly.\n\n**By using both plots together**, we can accurately classify regions into **LISA categories** such as High-High clusters (significant hotspots of high drug use cases), Low-Low clusters (regions of low drug use cases surrounded by similar values), and outliers (provinces where values deviate significantly from their neighbors). The combination of these plots ensures that we can distinguish between true spatial patterns and random variation, leading to more reliable insights into the distribution of drug-related incidents.\n:::\n\n::: panel-tabset\n## Year 2017\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% northeastern)\nnorthern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% northern)\nwestern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% western)\ncentral_lisa_2017 <- lisa_2017 %>% filter(province_en %in% central)\neastern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% eastern)\nsouthern_lisa_2017 <- lisa_2017 %>% filter(province_en %in% southern)\n\nnortheastern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% northeastern)\nnorthern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% northern)\nwestern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% western)\ncentral_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% central)\neastern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% eastern)\nsouthern_lisa_2017_sig <- lisa_2017_sig %>% filter(province_en %in% southern)\n```\n:::\n\n\n### Northeastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_local <- tm_shape(northeastern_lisa_2017)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Northeastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnortheastern_sig <- tm_shape(northeastern_lisa_2017)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Northeastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-112-1.png){width=1152}\n:::\n:::\n\n\n### Northern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnorthern_local <- tm_shape(northern_lisa_2017)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Northern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnorthern_sig <- tm_shape(northern_lisa_2017)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Northern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northern_local,northern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-113-1.png){width=1152}\n:::\n:::\n\n\n### Western Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nwestern_local <- tm_shape(western_lisa_2017)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Western Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nwestern_sig <- tm_shape(western_lisa_2017)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Western Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(western_local,western_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-114-1.png){width=1152}\n:::\n:::\n\n\n### Central Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ncentral_local <- tm_shape(central_lisa_2017)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Central Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ncentral_sig <- tm_shape(central_lisa_2017)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Central Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(central_local,central_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-115-1.png){width=1152}\n:::\n:::\n\n\n### Eastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\neastern_local <- tm_shape(eastern_lisa_2017)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Eastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\neastern_sig <- tm_shape(eastern_lisa_2017)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Eastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-116-1.png){width=1152}\n:::\n:::\n\n\n### Southern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nsouthern_local <- tm_shape(southern_lisa_2017)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Southern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nsouthern_sig <- tm_shape(southern_lisa_2017)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Southern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(southern_local,southern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-117-1.png){width=1152}\n:::\n:::\n\n\n### Analysis & Discussion\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Create the second map for northeastern_lisa_2017\nnortheastern_map <- tm_shape(northeastern_lisa_2017) +\n  tm_polygons(id=\"label\") +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(northeastern_lisa_2017_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2017 LISA plot of northeastern region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Create the first map for central_lisa_2017\ncentral_map <- tm_shape(central_lisa_2017) +\n  tm_polygons(id=\"label\") +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(central_lisa_2017_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2017 LISA plot of central region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Arrange the two maps side by side\ntmap_arrange(northeastern_map, central_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-118-1.png){width=1152}\n:::\n:::\n\n\nWithin the year 2017, the northeastern and central regions of Thailand present an intriguing spatial autocorrelation pattern characterized by the co-existence of **Low-Low** and **Low-High** clusters in the central region, and **High-High** clusters in the northeastern region.\n\nIn contrast, the **Northeastern region** (left plot) shows a pronounced **High-High** cluster in the eastern border provinces, where both the province and its neighbors experience high rates of drug use. This significant clustering highlights a potential hotspot in the northeastern part of Thailand, indicating areas that may require targeted interventions for drug-related issues.\n\nIn the **Central region** (right plot), we observe a combination of **Low-Low** clusters in the province of **Singburi**, where areas with low drug use rates are surrounded by similarly low-use neighbors, and **Low-High** clusters in the south, where provinces with higher drug use rates are adjacent to those with lower rates. This pattern suggests a transitional area where drug use may be increasing, potentially influenced by neighboring provinces that are experiencing higher levels of drug-related incidents. The close proximity could indicate a spillover effect, notably into the provinces of **Nonthaburi** and **Samut Prakan**, highlighting the importance of monitoring and addressing drug use in these interconnected areas to prevent further escalation. Overall, the central region's mixed clustering patterns reveal a complex landscape of drug use, necessitating tailored strategies for intervention and prevention.\n\n## Year 2018\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% northeastern)\nnorthern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% northern)\nwestern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% western)\ncentral_lisa_2018 <- lisa_2018 %>% filter(province_en %in% central)\neastern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% eastern)\nsouthern_lisa_2018 <- lisa_2018 %>% filter(province_en %in% southern)\n\nnortheastern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% northeastern)\nnorthern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% northern)\nwestern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% western)\ncentral_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% central)\neastern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% eastern)\nsouthern_lisa_2018_sig <- lisa_2018_sig %>% filter(province_en %in% southern)\n```\n:::\n\n\n### Northeastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_local <- tm_shape(northeastern_lisa_2018)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Northeastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnortheastern_sig <- tm_shape(northeastern_lisa_2018)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Northeastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-120-1.png){width=1152}\n:::\n:::\n\n\n### Northern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnorthern_local <- tm_shape(northern_lisa_2018)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Northern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnorthern_sig <- tm_shape(northern_lisa_2018)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Northern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northern_local,northern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-121-1.png){width=1152}\n:::\n:::\n\n\n### Western Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nwestern_local <- tm_shape(western_lisa_2018)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Western Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nwestern_sig <- tm_shape(western_lisa_2018)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Western Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(western_local,western_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-122-1.png){width=1152}\n:::\n:::\n\n\n### Central Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ncentral_local <- tm_shape(central_lisa_2018)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Central Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ncentral_sig <- tm_shape(central_lisa_2018)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Central Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(central_local,central_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-123-1.png){width=1152}\n:::\n:::\n\n\n### Eastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\neastern_local <- tm_shape(eastern_lisa_2018)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Eastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\neastern_sig <- tm_shape(eastern_lisa_2018)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Eastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-124-1.png){width=1152}\n:::\n:::\n\n\n### Southern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nsouthern_local <- tm_shape(southern_lisa_2018)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Southern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nsouthern_sig <- tm_shape(southern_lisa_2018)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), ,\n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Southern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(southern_local,southern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-125-1.png){width=1152}\n:::\n:::\n\n\n### Analysis & Discussion\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Create the second map for northeastern_lisa_2018\nnortheastern_map <- tm_shape(northeastern_lisa_2018) +\n  tm_polygons(id=\"label\") +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(northeastern_lisa_2018_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2018 LISA plot of northeastern region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Create the first map for central_lisa_2018\ncentral_map <- tm_shape(central_lisa_2018) +\n  tm_polygons(id=\"label\") +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(central_lisa_2018_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2018 LISA plot of central region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Arrange the two maps side by side\ntmap_arrange(northeastern_map, central_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-126-1.png){width=1152}\n:::\n:::\n\n\nIn 2018, the spatial autocorrelation patterns in the northeastern and central regions of Thailand reveal notable shifts in the classification of drug use incidents compared to the previous year.\n\nIn the **Northeastern region** (left plot), we observe a significant presence of **High-Low** clusters, particularly in the northern provinces. This indicates that areas with high drug use rates are bordered by regions with lower rates, suggesting a potential influence or spillover effect where increased drug activity in some areas may affect their neighbors. The rest of the region largely remains unclassified, highlighting a shift in the drug use dynamics in this area.\n\nConversely, in the **Central region** (right plot), there is a noticeable increase in **High-High** clusters, especially in the southern provinces, where areas with high drug use rates are surrounded by similarly high-use neighbors. This indicates that drug-related issues may be more concentrated in these provinces, necessitating targeted interventions to address the growing problem. Additionally, **Low-Low** clusters can be seen in some provinces, where low drug use rates are observed alongside similarly low-use areas, signifying pockets of stability amidst rising drug use in surrounding regions.\n\nOverall, both regions illustrate the evolving landscape of drug use in Thailand in 2018, emphasizing the importance of spatial analysis in understanding and responding to changing patterns in drug-related incidents. The identification of clusters can inform policy decisions and resource allocation for effective intervention strategies.\n\n## Year 2019\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% northeastern)\nnorthern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% northern)\nwestern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% western)\ncentral_lisa_2019 <- lisa_2019 %>% filter(province_en %in% central)\neastern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% eastern)\nsouthern_lisa_2019 <- lisa_2019 %>% filter(province_en %in% southern)\n\nnortheastern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% northeastern)\nnorthern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% northern)\nwestern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% western)\ncentral_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% central)\neastern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% eastern)\nsouthern_lisa_2019_sig <- lisa_2019_sig %>% filter(province_en %in% southern)\n```\n:::\n\n\n### Northeastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_local <- tm_shape(northeastern_lisa_2019)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Northeastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnortheastern_sig <- tm_shape(northeastern_lisa_2019)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Northeastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-128-1.png){width=1152}\n:::\n:::\n\n\n### Northern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnorthern_local <- tm_shape(northern_lisa_2019)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Northern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnorthern_sig <- tm_shape(northern_lisa_2019)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Northern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northern_local,northern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-129-1.png){width=1152}\n:::\n:::\n\n\n### Western Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nwestern_local <- tm_shape(western_lisa_2019)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Western Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nwestern_sig <- tm_shape(western_lisa_2019)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Western Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(western_local,western_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-130-1.png){width=1152}\n:::\n:::\n\n\n### Central Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ncentral_local <- tm_shape(central_lisa_2019)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ncentral_sig <- tm_shape(central_lisa_2019)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(central_local,central_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-131-1.png){width=1152}\n:::\n:::\n\n\n### Eastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\neastern_local <- tm_shape(eastern_lisa_2019)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Eastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\neastern_sig <- tm_shape(eastern_lisa_2019)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Eastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-132-1.png){width=1152}\n:::\n:::\n\n\n### Southern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nsouthern_local <- tm_shape(southern_lisa_2019)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Southern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nsouthern_sig <- tm_shape(southern_lisa_2019)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Southern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(southern_local,southern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-133-1.png){width=1152}\n:::\n:::\n\n\n### Analysis & Discussion\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Create the second map for northeastern_lisa_2019\nnortheastern_map <- tm_shape(northeastern_lisa_2019) +\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(northeastern_lisa_2019_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2019 LISA plot of northeastern region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Create the first map for central_lisa_2019\ncentral_map <- tm_shape(central_lisa_2019) +\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(central_lisa_2019_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2019 LISA plot of central region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Arrange the two maps side by side\ntmap_arrange(northeastern_map, central_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-134-1.png){width=1152}\n:::\n:::\n\n\nIn 2019, the spatial autocorrelation patterns in the northeastern and central regions of Thailand present distinct shifts in drug use classifications compared to previous years.\n\nIn the **Northeastern region** (left plot), there is a notable concentration of **High-High** clusters in the southern part, indicating that provinces with high drug use rates are situated near other high-use provinces. Combined with the data from previous years, this suggests a persistence of drug-related issues in this area, requiring ongoing attention from policymakers and law enforcement. Additionally, some border provinces in the northern part of the region are classified as **Low-Low**, showing that these areas are characterized by low drug use rates surrounded by similarly low-use neighbors. This combination of clustering patterns highlights the complex landscape of drug use in the northeastern region, where areas of high intensity coexist with regions exhibiting stability in low usage.\n\nIn the **Central region** (right plot), we observe a significant presence of **High-High** clusters concentrated in the southern provinces, particularly in the province of **Samut Prakan**. This reinforces the trend of increased drug-related activities in this part of the region compared to the rest of the region as seen from the past 2 years.\n\nOverall, both regions reveal a continued need for targeted interventions and policy adaptations to address the shifting patterns of drug use across Thailand's northeastern and central regions. The persistence of high-use clusters in specific areas highlights the importance of focused resource allocation and strategic planning to combat drug-related challenges effectively.\n\n## Year 2020\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% northeastern)\nnorthern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% northern)\nwestern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% western)\ncentral_lisa_2020 <- lisa_2020 %>% filter(province_en %in% central)\neastern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% eastern)\nsouthern_lisa_2020 <- lisa_2020 %>% filter(province_en %in% southern)\n\nnortheastern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% northeastern)\nnorthern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% northern)\nwestern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% western)\ncentral_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% central)\neastern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% eastern)\nsouthern_lisa_2020_sig <- lisa_2020_sig %>% filter(province_en %in% southern)\n```\n:::\n\n\n### Northeastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_local <- tm_shape(northeastern_lisa_2020)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Northeastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnortheastern_sig <- tm_shape(northeastern_lisa_2020)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in Northeastern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-136-1.png){width=1152}\n:::\n:::\n\n\n### Northern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnorthern_local <- tm_shape(northern_lisa_2020)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in Northern Region\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnorthern_sig <- tm_shape(northern_lisa_2020)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northern_local,northern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-137-1.png){width=1152}\n:::\n:::\n\n\n### Western Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nwestern_local <- tm_shape(western_lisa_2020)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nwestern_sig <- tm_shape(western_lisa_2020)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(western_local,western_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-138-1.png){width=1152}\n:::\n:::\n\n\n### Central Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ncentral_local <- tm_shape(central_lisa_2020)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ncentral_sig <- tm_shape(central_lisa_2020)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(central_local,central_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-139-1.png){width=1152}\n:::\n:::\n\n\n### Eastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\neastern_local <- tm_shape(eastern_lisa_2020)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\neastern_sig <- tm_shape(eastern_lisa_2020)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-140-1.png){width=1152}\n:::\n:::\n\n\n### Southern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nsouthern_local <- tm_shape(southern_lisa_2020)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nsouthern_sig <- tm_shape(southern_lisa_2020)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(southern_local,southern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-141-1.png){width=1152}\n:::\n:::\n\n\n### Analysis & Discussion\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Create the first map for central_lisa_2020\ncentral_map <- tm_shape(central_lisa_2020) +\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(central_lisa_2020_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2020 LISA plot of central region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Create the second map for eastern_lisa_2020\neastern_map <- tm_shape(eastern_lisa_2020) +\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(eastern_lisa_2020_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2020 LISA plot of eastern region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Arrange the two maps side by side\ntmap_arrange(central_map, eastern_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-142-1.png){width=1152}\n:::\n:::\n\n\nIn 2020, the spatial autocorrelation patterns in the eastern and central regions of Thailand present distinct shifts in drug use classifications compared to previous years.\n\nIn the **Central region** (left plot), there is a notable concentration of **Low-High** clusters in the southern part, indicating that provinces with high drug use rates are situated near other high-use provinces. Combined with the data from previous years, this suggests a persistence of drug-related issues in this area, requiring ongoing attention from policymakers and law enforcement.\n\nIn the **Eastern region** (right plot), we observe some border provinces in the northern part of the region are classified as **Low-High**, showing that these areas are characterized by low drug use rates surrounded by high-use neighbors. It is noteworthy that the area is also at the eastern border, similar to those clusters in the previous years. Additionally, a significant presence of **High-High** clusters concentrated in the western provinces, particularly in the province of **Chachoengsao**. This cluster is neigbhouring the **Low-High** cluster of **Central region**, connecting the 2020 highlighted clusters together in both regions.\n\nOverall, both regions reveal a continued need for targeted interventions and policy adaptations to address the shifting patterns of drug use across Thailand's regions. The persistence of high-use clusters in the eastern border provinces and central region specifically highlights the importance of focused resource allocation and strategic planning to combat drug-related challenges effectively.\n\n## Year 2021\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% northeastern)\nnorthern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% northern)\nwestern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% western)\ncentral_lisa_2021 <- lisa_2021 %>% filter(province_en %in% central)\neastern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% eastern)\nsouthern_lisa_2021 <- lisa_2021 %>% filter(province_en %in% southern)\n\nnortheastern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% northeastern)\nnorthern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% northern)\nwestern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% western)\ncentral_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% central)\neastern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% eastern)\nsouthern_lisa_2021_sig <- lisa_2021_sig %>% filter(province_en %in% southern)\n```\n:::\n\n\n### Northeastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_local <- tm_shape(northeastern_lisa_2021)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnortheastern_sig <- tm_shape(northeastern_lisa_2021)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-144-1.png){width=1152}\n:::\n:::\n\n\n### Northern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnorthern_local <- tm_shape(northern_lisa_2021)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnorthern_sig <- tm_shape(northern_lisa_2021)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northern_local,northern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-145-1.png){width=1152}\n:::\n:::\n\n\n### Western Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nwestern_local <- tm_shape(western_lisa_2021)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nwestern_sig <- tm_shape(western_lisa_2021)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(western_local,western_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-146-1.png){width=1152}\n:::\n:::\n\n\n### Central Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ncentral_local <- tm_shape(central_lisa_2021)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ncentral_sig <- tm_shape(central_lisa_2021)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(central_local,central_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-147-1.png){width=1152}\n:::\n:::\n\n\n### Eastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\neastern_local <- tm_shape(eastern_lisa_2021)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\neastern_sig <- tm_shape(eastern_lisa_2021)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-148-1.png){width=1152}\n:::\n:::\n\n\n### Southern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nsouthern_local <- tm_shape(southern_lisa_2021)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nsouthern_sig <- tm_shape(southern_lisa_2021)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(southern_local,southern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-149-1.png){width=1152}\n:::\n:::\n\n\n### Analysis & Discussion\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Create the second map for western_lisa_2021\nwestern_map <- tm_shape(western_lisa_2021) +\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(western_lisa_2021_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2021 LISA plot of western region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Create the first map for central_lisa_2021\ncentral_map <- tm_shape(central_lisa_2021) +\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(central_lisa_2021_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2021 LISA plot of central region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Arrange the two maps side by side\ntmap_arrange(western_map, central_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-150-1.png){width=1152}\n:::\n:::\n\n\nIn 2021, the spatial autocorrelation patterns in the western and central regions of Thailand present distinct shifts in drug use classifications compared to previous years.\n\nIn the **Western region** (left plot), there is a notable concentration of **Low-Low** clusters in the central part. These clusters indicate that these provinces and their neighbors experience consistently lower drug-related cases compared to the rest of the region.\n\nIn the **Central region** (right plot), we observe a significant presence of **Low-Low** clusters concentrated in the western and southern provinces. These cluster is neigbhouring the **Low-Low** cluster of **Western region**, connecting the 2021 highlighted clusters together in both regions. This shows that this areas are characterized by low drug use rates surrounded by low-use neighbors.\n\nOverall, the plots highlight a significant presence of Low-Low clusters in both the Western and Central regions, suggesting that several provinces in these areas have lower-than-average drug-related cases compared to their neighbors. The patterns are consistent across multiple neighbouring provinces, indicating potential coldspots that may benefit from maintaining existing preventative measures. Additionally, the absence of High-High clusters in all regions for 2021 implies that there were no significant hotspots for drug abuse activity, indicating either a reduction in drug-related cases or a more uniform distribution across these regions.\n\n## Year 2022\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% northeastern)\nnorthern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% northern)\nwestern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% western)\ncentral_lisa_2022 <- lisa_2022 %>% filter(province_en %in% central)\neastern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% eastern)\nsouthern_lisa_2022 <- lisa_2022 %>% filter(province_en %in% southern)\n\nnortheastern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% northeastern)\nnorthern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% northern)\nwestern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% western)\ncentral_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% central)\neastern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% eastern)\nsouthern_lisa_2022_sig <- lisa_2022_sig %>% filter(province_en %in% southern)\n```\n:::\n\n\n### Northeastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnortheastern_local <- tm_shape(northeastern_lisa_2022)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnortheastern_sig <- tm_shape(northeastern_lisa_2022)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northeastern_local,northeastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-152-1.png){width=1152}\n:::\n:::\n\n\n### Northern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnorthern_local <- tm_shape(northern_lisa_2022)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nnorthern_sig <- tm_shape(northern_lisa_2022)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(northern_local,northern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-153-1.png){width=1152}\n:::\n:::\n\n\n### Western Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nwestern_local <- tm_shape(western_lisa_2022)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nwestern_sig <- tm_shape(western_lisa_2022)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(western_local,western_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-154-1.png){width=1152}\n:::\n:::\n\n\n### Central Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ncentral_local <- tm_shape(central_lisa_2022)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ncentral_sig <- tm_shape(central_lisa_2022)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(central_local,central_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-155-1.png){width=1152}\n:::\n:::\n\n\n### Eastern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\neastern_local <- tm_shape(eastern_lisa_2022)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\neastern_sig <- tm_shape(eastern_lisa_2022)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(eastern_local,eastern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-156-1.png){width=1152}\n:::\n:::\n\n\n### Southern Region\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nsouthern_local <- tm_shape(southern_lisa_2022)+\n  tm_fill(\"ii\", \n          palette = c(\"#e1ecbb\",\"#f5f3a6\", \"#ec9a64\",\"#de573e\",\"#d21b1c\"),\n          title = \"Local Moran's I\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Village-Level Spatial Autocorrelation \\nof drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\nsouthern_sig <- tm_shape(southern_lisa_2022)+\n  tm_fill(\"p_ii_sim\", \n          palette = c(\"#d21b1c\",\"#ec9a64\",\"#f5f3a6\",\"#c9e3d2\",\"#b7dce9\"),\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"), \n          title = \"p-value\",\n          midpoint = NA) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistical Significance of Spatial Autocorrelation\\n of drug use cases in North District\",\n            main.title.position = \"center\",\n            main.title.size = 1.3,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1,\n            legend.text.size = 0.8,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1, size = 2, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1) +\n  tm_grid(labels.size = 1,alpha =0.2)\n\ntmap_arrange(southern_local,southern_sig, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-157-1.png){width=1152}\n:::\n:::\n\n\n### Analysis & Discussion\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Create the second map for northeastern_lisa_2022\nnortheastern_map <- tm_shape(northeastern_lisa_2022) +\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(northeastern_lisa_2022_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2022 LISA plot of northeastern region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Create the first map for central_lisa_2022\ncentral_map <- tm_shape(central_lisa_2022) +\n  tm_polygons() +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_shape(central_lisa_2022_sig) +\n  tm_fill(\"mean\", \n          palette = c(\"#b7dce9\",\"#ec9a64\",\"#e1ecbb\", \"#d21b1c\"),\n          title = \"LISA class\",\n          midpoint = NA,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.5) +\n  tm_borders(col = \"black\", alpha = 0.6) +\n  tm_layout(main.title = \"2022 LISA plot of central region\",\n            main.title.size = 0.8,\n            legend.outside = TRUE)\n\n# Arrange the two maps side by side\ntmap_arrange(northeastern_map, central_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-158-1.png){width=1152}\n:::\n:::\n\n\nIn 2022, the spatial autocorrelation patterns in the northeastern and central regions of Thailand present distinct shifts in drug use classifications compared to previous years.\n\nIn the **Northeastern region** (left plot), there is a notable concentration of **High-High** clusters, covering a few central provinces. This indicates that these provinces and their neighboring areas have higher-than-average drug-related cases, creating a significant hotspot. There is also a **Low-High** cluster in one province to the west of the hotspot. This pattern suggests that the province itself has low drug-related cases, but it is surrounded by high-value neighbors.\n\nIn the **Central region** (right plot), we observe a significant presence of **Low-Low** clusters in a few western and central provinces. Referencing the cluster data of 2021, this coldspot have consistently shown lower drug-related cases compared to the rest of the region.\n\nOverall, the Northeastern region exhibits significant hotspots indicating provinces with elevated drug-related cases, which are surrounded by other high-case provinces. This is a marked contrast from the absence of such clusters in the Central region, which only shows Low-Low clusters representing coldspots.\n\nThe emergence of High-High clusters in the Northeastern region could point to new areas of concern that require targeted intervention strategies, while the presence of Low-Low clusters in the Central region suggests continued effectiveness in maintaining low levels of drug-related activities.\n:::\n\n## 2.8 Hot Spot and Cold Spot Area Analysis\n\nThe **Local Getis-Ord Gi\\* statistic** is a spatial analysis technique used to identify **hotspots** and **coldspots** within geographic data. It measures spatial clustering by determining whether features with high or low values are spatially clustered.\n\n### 2.8.1 Local Getis-Ord Gi for Hot Spot and Cold Spot Area Analysis\n\nIn the context of this analysis, Gi\\* helps identify areas with significantly high or low values of interest relative to their neighbors. A **hotspot** is an area where high values cluster, while a **coldspot** is where low values cluster.\n\nKey aspects of the Getis-Ord Gi\\* statistic include:\n\n1.  **Z-Scores and p-values**: These indicate the statistical significance of the clustering. A high positive Gi\\* value with a low p-value suggests a hotspot, while a low negative Gi\\* value indicates a coldspot. Statistical significance is often represented using thresholds (e.g., p \\< 0.05).\n\n2.  **Spatial Weighting**: Gi\\* takes into account not just the value of the feature but also the values of neighboring features within a specified distance. The statistic compares the local mean to the global mean to assess whether clustering is due to chance or significant spatial patterns.\n\n3.  **Application in Hotspot & Coldspot Analysis**: In this analysis, the Gi\\* statistic is applied to geographical areas to identify statistically significant areas of unusually high or low values of the phenomenon under study, such as drug use cases. These areas can then be visualized using a color scale, helping researchers or decision-makers focus on regions that exhibit non-random spatial patterns.\n\nBy visualizing Gi\\* results on a map, we can better understand the spatial dynamics of an issue and prioritize interventions in areas of concern.\n\nWe start by calculating **Inverse Distance Weighted (IDW)** spatial weight matrices for the years 2017-2022 using contiguity-based neighborhoods. Each region is considered as its own neighbor (with `include_self`), and spatial weights are assigned based on the inverse distance between regions (`st_inverse_distance`), giving more weight to closer regions. This creates a foundation for spatial autocorrelation analysis by providing the necessary spatial relationships for each year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_idw_2017 <- region_2017_sf %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nwm_idw_2018 <- region_2018_sf %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nwm_idw_2019 <- region_2019_sf %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nwm_idw_2020 <- region_2020_sf %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nwm_idw_2021 <- region_2021_sf %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nwm_idw_2022 <- region_2022_sf %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\n```\n:::\n\n\nWe store the yearly spatial weight matrices for ease of use\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(wm_idw_2017, \"data/rds/wm_idw_2017.rds\")\nwrite_rds(wm_idw_2018, \"data/rds/wm_idw_2018.rds\")\nwrite_rds(wm_idw_2019, \"data/rds/wm_idw_2019.rds\")\nwrite_rds(wm_idw_2020, \"data/rds/wm_idw_2020.rds\")\nwrite_rds(wm_idw_2021, \"data/rds/wm_idw_2021.rds\")\nwrite_rds(wm_idw_2022, \"data/rds/wm_idw_2022.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_idw_2017 <- read_rds(\"data/rds/wm_idw_2017.rds\")\nwm_idw_2018 <- read_rds(\"data/rds/wm_idw_2018.rds\")\nwm_idw_2019 <- read_rds(\"data/rds/wm_idw_2019.rds\")\nwm_idw_2020 <- read_rds(\"data/rds/wm_idw_2020.rds\")\nwm_idw_2021 <- read_rds(\"data/rds/wm_idw_2021.rds\")\nwm_idw_2022 <- read_rds(\"data/rds/wm_idw_2022.rds\")\n```\n:::\n\n\nWe apply the **Local Getis-Ord Gi**\\* statistic to identify spatial clusters (hotspots and coldspots) of cases for each year (2017-2022) onto the yearly spatial weight matrices. Using the `local_gstar_perm()` function, it calculates Gi values for each region, based on the case counts (`no_cases`), spatial neighbors (`nb`), and their corresponding weights (`wt`), with 99 Monte Carlo simulations (`nsim = 99`) for statistical significance. The results are then added back to the dataset for visualization and further analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4242)\n\nHCSA_2017 <- wm_idw_2017 %>% \n  mutate(local_Gi_star = local_gstar_perm(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi_star)\nHCSA_2018 <- wm_idw_2018 %>% \n  mutate(local_Gi_star = local_gstar_perm(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi_star)\nHCSA_2018 <- wm_idw_2018 %>% \n  mutate(local_Gi_star = local_gstar_perm(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi_star)\nHCSA_2019 <- wm_idw_2019 %>% \n  mutate(local_Gi_star = local_gstar_perm(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi_star)\nHCSA_2020 <- wm_idw_2020 %>% \n  mutate(local_Gi_star = local_gstar_perm(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi_star)\nHCSA_2021 <- wm_idw_2021 %>% \n  mutate(local_Gi_star = local_gstar_perm(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi_star)\nHCSA_2022 <- wm_idw_2022 %>% \n  mutate(local_Gi_star = local_gstar_perm(\n    no_cases, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi_star)\n```\n:::\n\n\n::: panel-tabset\n## 2017\n\n### Map of Hotspots & Coldspots of Drug Use Cases in Thailand\n\nFirst we generate a map of Thailand for the current year, showing the **hotspots** and **coldspots** of drug use cases using Gi statistics. The fill color is determined by the **gi_star** column using a specified color palette, with a midpoint of 0 to distinguish between hotspots (**positive Gi**) and coldspots (**negative Gi**). The map also includes borders, a title, a compass, a scale bar, and a grid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2017)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          title = \"Gi*\",\n          midpoint = 0) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2017 Hotspots & Coldspots of drug\\n use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-163-1.png){width=1152}\n:::\n:::\n\n\n### Map of Statistically Significant Hotspots & Coldspots of Drug Use Cases\n\nWe then create a map similar to the previous one but filters the data to only show provinces where the **p_sim value is less than 0.05** (indicating statistically significant results). It visualizes the **statistically significant** **hotspots** **and** **coldspots**, with **gi_star** values categorized into specific intervals (`breaks = c(-2, 0, 2, 4, 6, 8)`), and includes a histogram in the legend for distribution reference.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_2017_sig <- HCSA_2017  %>%\n  filter(p_sim < 0.05)\n\ntm_shape(HCSA_2017) +\n  tm_polygons() +\ntm_shape(HCSA_2017_sig)+\n  tm_fill(\"gi_star\", \n          title = \"Gi*\",\n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          breaks = c(-2, 0, 2, 4, 6, 8), \n          midpoint = 0,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Hotspots & Coldspots \\nof Drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-164-1.png){width=1152}\n:::\n:::\n\n\n### Top Hotspots and Coldspots Identification\n\nWe then identify the top hotspot provinces (with the **highest** **positive** **gi_star** values) and the top coldspot provinces (with the **lowest negative gi_star** values). It uses the filtered `HCSA_<current_year>_sig` dataset and arranges the values in descending and ascending order, respectively, to extract the top provinces.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the top 3 hotspots (highest positive gi_star values)\ntop_hotspots <- HCSA_2017_sig %>%\n  arrange(desc(gi_star)) %>%\n  head(3) %>%\n  pull(province_en)\n\n# Get the top 3 cold spots (lowest negative gi_star values)\ntop_coldspots <- HCSA_2017_sig %>%\n  filter(!(province_en %in% top_hotspots)) %>%\n  arrange(gi_star) %>%\n  head(3) %>%\n  pull(province_en)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_top_hotspots <- HCSA_2017_sig %>% filter(province_en %in% top_hotspots)\nHCSA_top_coldspots <- HCSA_2017_sig %>% filter(province_en %in% top_coldspots)\n\ntm_shape(HCSA_2017) +\n  tm_polygons() +\ntm_shape(HCSA_top_hotspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#f67774\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\",auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Hotspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-166-1.png){width=1152}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2017) +\n  tm_polygons() +\ntm_shape(HCSA_top_coldspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\", auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Coldspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-167-1.png){width=1152}\n:::\n:::\n\n\n## 2018\n\n### Map of Hotspots & Coldspots of Drug Use Cases in Thailand\n\nFirst we generate a map of Thailand for the current year, showing the **hotspots** and **coldspots** of drug use cases using Gi statistics. The fill color is determined by the **gi_star** column using a specified color palette, with a midpoint of 0 to distinguish between hotspots (**positive Gi**) and coldspots (**negative Gi**). The map also includes borders, a title, a compass, a scale bar, and a grid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2018)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          title = \"Gi*\",\n          midpoint = 0) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2018 Hotspots & Coldspots of drug\\n use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-168-1.png){width=1152}\n:::\n:::\n\n\n### Map of Statistically Significant Hotspots & Coldspots of Drug Use Cases\n\nWe then create a map similar to the previous one but filters the data to only show provinces where the **p_sim value is less than 0.05** (indicating statistically significant results). It visualizes the **statistically significant** **hotspots** **and** **coldspots**, with **gi_star** values categorized into specific intervals (`breaks = c(-2, 0, 2, 4, 6, 8)`), and includes a histogram in the legend for distribution reference.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_2018_sig <- HCSA_2018  %>%\n  filter(p_sim < 0.05)\n\ntm_shape(HCSA_2018) +\n  tm_polygons() +\ntm_shape(HCSA_2018_sig)+\n  tm_fill(\"gi_star\", \n          title = \"Gi*\",\n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          breaks = c(-2, 0, 2, 4, 6, 8), \n          midpoint = 0,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Hotspots & Coldspots \\nof Drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-169-1.png){width=1152}\n:::\n:::\n\n\n### Top Hotspots and Coldspots Identification\n\nWe then identify the top hotspot provinces (with the **highest** **positive** **gi_star** values) and the top coldspot provinces (with the **lowest negative gi_star** values). It uses the filtered `HCSA_<current_year>_sig` dataset and arranges the values in descending and ascending order, respectively, to extract the top provinces.\n\nFrom the plot above, it, there is only 1 statistically significant hotspot during the year 2018. We will get the top hotspot based on `gi_star` value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the top hotspot (highest positive gi_star values)\ntop_hotspots <- HCSA_2018_sig %>%\n  arrange(desc(gi_star)) %>%\n  head(1) %>%\n  pull(province_en)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_top_hotspots <- HCSA_2018_sig %>% filter(province_en %in% top_hotspots)\nHCSA_top_coldspots <- HCSA_2018_sig %>% filter(province_en %in% top_coldspots)\n\ntm_shape(HCSA_2018) +\n  tm_polygons() +\ntm_shape(HCSA_top_hotspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#f67774\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\",auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Hotspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-171-1.png){width=1152}\n:::\n:::\n\n\n## 2019\n\n### Map of Hotspots & Coldspots of Drug Use Cases in Thailand\n\nFirst we generate a map of Thailand for the current year, showing the **hotspots** and **coldspots** of drug use cases using Gi statistics. The fill color is determined by the **gi_star** column using a specified color palette, with a midpoint of 0 to distinguish between hotspots (**positive Gi**) and coldspots (**negative Gi**). The map also includes borders, a title, a compass, a scale bar, and a grid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2019)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          title = \"Gi*\",\n          midpoint = 0) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2019 Hotspots & Coldspots of drug\\n use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-172-1.png){width=1152}\n:::\n:::\n\n\n### Map of Statistically Significant Hotspots & Coldspots of Drug Use Cases\n\nWe then create a map similar to the previous one but filters the data to only show provinces where the **p_sim value is less than 0.05** (indicating statistically significant results). It visualizes the **statistically significant** **hotspots** **and** **coldspots**, with **gi_star** values categorized into specific intervals (`breaks = c(-2, 0, 2, 4, 6, 8)`), and includes a histogram in the legend for distribution reference.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_2019_sig <- HCSA_2019  %>%\n  filter(p_sim < 0.05)\n\ntm_shape(HCSA_2019) +\n  tm_polygons() +\ntm_shape(HCSA_2019_sig)+\n  tm_fill(\"gi_star\", \n          title = \"Gi*\",\n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          breaks = c(-2, 0, 2, 4, 6, 8), \n          midpoint = 0,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Hotspots & Coldspots \\nof Drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-173-1.png){width=1152}\n:::\n:::\n\n\n### Top Hotspots and Coldspots Identification\n\nWe then identify the top hotspot provinces (with the **highest** **positive** **gi_star** values) and the top coldspot provinces (with the **lowest negative gi_star** values). It uses the filtered `HCSA_<current_year>_sig` dataset and arranges the values in descending and ascending order, respectively, to extract the top provinces.\n\nFrom the plot above, it, there is only 1 statistically significant hotspot during the year 2018. We will get the top hotspot based on `gi_star` value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the top hotspot (highest positive gi_star values)\ntop_hotspots <- HCSA_2019_sig %>%\n  arrange(desc(gi_star)) %>%\n  head(1) %>%\n  pull(province_en)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_top_hotspots <- HCSA_2019_sig %>% filter(province_en %in% top_hotspots)\nHCSA_top_coldspots <- HCSA_2019_sig %>% filter(province_en %in% top_coldspots)\n\ntm_shape(HCSA_2019) +\n  tm_polygons() +\ntm_shape(HCSA_top_hotspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#f67774\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\",auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Hotspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-175-1.png){width=1152}\n:::\n:::\n\n\n## 2020\n\n### Map of Hotspots & Coldspots of Drug Use Cases in Thailand\n\nFirst we generate a map of Thailand for the current year, showing the **hotspots** and **coldspots** of drug use cases using Gi statistics. The fill color is determined by the **gi_star** column using a specified color palette, with a midpoint of 0 to distinguish between hotspots (**positive Gi**) and coldspots (**negative Gi**). The map also includes borders, a title, a compass, a scale bar, and a grid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2020)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          title = \"Gi*\",\n          midpoint = 0) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2020 Hotspots & Coldspots of drug\\n use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-176-1.png){width=1152}\n:::\n:::\n\n\n### Map of Statistically Significant Hotspots & Coldspots of Drug Use Cases\n\nWe then create a map similar to the previous one but filters the data to only show provinces where the **p_sim value is less than 0.05** (indicating statistically significant results). It visualizes the **statistically significant** **hotspots** **and** **coldspots**, with **gi_star** values categorized into specific intervals (`breaks = c(-2, 0, 2, 4, 6, 8)`), and includes a histogram in the legend for distribution reference.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_2020_sig <- HCSA_2020  %>%\n  filter(p_sim < 0.05)\n\ntm_shape(HCSA_2020) +\n  tm_polygons() +\ntm_shape(HCSA_2020_sig)+\n  tm_fill(\"gi_star\", \n          title = \"Gi*\",\n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          breaks = c(-2, 0, 2, 4, 6, 8), \n          midpoint = 0,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Hotspots & Coldspots \\nof Drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-177-1.png){width=1152}\n:::\n:::\n\n\n### Top Hotspots and Coldspots Identification\n\nWe then identify the top hotspot provinces (with the **highest** **positive** **gi_star** values) and the top coldspot provinces (with the **lowest negative gi_star** values). It uses the filtered `HCSA_<current_year>_sig` dataset and arranges the values in descending and ascending order, respectively, to extract the top provinces.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the top 3 hotspots (highest positive gi_star values)\ntop_hotspots <- HCSA_2020_sig %>%\n  arrange(desc(gi_star)) %>%\n  head(3) %>%\n  pull(province_en)\n\n# Get the top 3 cold spots (lowest negative gi_star values)\ntop_coldspots <- HCSA_2020_sig %>%\n  filter(!(province_en %in% top_hotspots)) %>%\n  arrange(gi_star) %>%\n  head(3) %>%\n  pull(province_en)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_top_hotspots <- HCSA_2020_sig %>% filter(province_en %in% top_hotspots)\nHCSA_top_coldspots <- HCSA_2020_sig %>% filter(province_en %in% top_coldspots)\n\ntm_shape(HCSA_2020) +\n  tm_polygons() +\ntm_shape(HCSA_top_hotspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#f67774\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\",auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Hotspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-179-1.png){width=1152}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2020) +\n  tm_polygons() +\ntm_shape(HCSA_top_coldspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\", auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Coldspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-180-1.png){width=1152}\n:::\n:::\n\n\n## 2021\n\n### Map of Hotspots & Coldspots of Drug Use Cases in Thailand\n\nFirst we generate a map of Thailand for the current year, showing the **hotspots** and **coldspots** of drug use cases using Gi statistics. The fill color is determined by the **gi_star** column using a specified color palette, with a midpoint of 0 to distinguish between hotspots (**positive Gi**) and coldspots (**negative Gi**). The map also includes borders, a title, a compass, a scale bar, and a grid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2021)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          title = \"Gi*\",\n          midpoint = 0) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2021 Hotspots & Coldspots of drug\\n use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-181-1.png){width=1152}\n:::\n:::\n\n\n### Map of Statistically Significant Hotspots & Coldspots of Drug Use Cases\n\nWe then create a map similar to the previous one but filters the data to only show provinces where the **p_sim value is less than 0.05** (indicating statistically significant results). It visualizes the **statistically significant** **hotspots** **and** **coldspots**, with **gi_star** values categorized into specific intervals (`breaks = c(-2, 0, 2, 4, 6, 8)`), and includes a histogram in the legend for distribution reference.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_2021_sig <- HCSA_2021  %>%\n  filter(p_sim < 0.05)\n\ntm_shape(HCSA_2021) +\n  tm_polygons() +\ntm_shape(HCSA_2021_sig)+\n  tm_fill(\"gi_star\", \n          title = \"Gi*\",\n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          breaks = c(-2, 0, 2, 4, 6, 8), \n          midpoint = 0,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Hotspots & Coldspots \\nof Drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-182-1.png){width=1152}\n:::\n:::\n\n\n### Top Hotspots and Coldspots Identification\n\nWe then identify the top hotspot provinces (with the **highest** **positive** **gi_star** values) and the top coldspot provinces (with the **lowest negative gi_star** values). It uses the filtered `HCSA_<current_year>_sig` dataset and arranges the values in descending and ascending order, respectively, to extract the top provinces.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the top 3 hotspots (highest positive gi_star values)\ntop_hotspots <- HCSA_2021_sig %>%\n  arrange(desc(gi_star)) %>%\n  head(3) %>%\n  pull(province_en)\n\n# Get the top 3 cold spots (lowest negative gi_star values)\ntop_coldspots <- HCSA_2021_sig %>%\n  filter(!(province_en %in% top_hotspots)) %>%\n  arrange(gi_star) %>%\n  head(3) %>%\n  pull(province_en)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_top_hotspots <- HCSA_2021_sig %>% filter(province_en %in% top_hotspots)\nHCSA_top_coldspots <- HCSA_2021_sig %>% filter(province_en %in% top_coldspots)\n\ntm_shape(HCSA_2021) +\n  tm_polygons() +\ntm_shape(HCSA_top_hotspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#f67774\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\",auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Hotspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-184-1.png){width=1152}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2021) +\n  tm_polygons() +\ntm_shape(HCSA_top_coldspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\", auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Coldspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-185-1.png){width=1152}\n:::\n:::\n\n\n## 2022\n\n### Map of Hotspots & Coldspots of Drug Use Cases in Thailand\n\nFirst we generate a map of Thailand for the current year, showing the **hotspots** and **coldspots** of drug use cases using Gi statistics. The fill color is determined by the **gi_star** column using a specified color palette, with a midpoint of 0 to distinguish between hotspots (**positive Gi**) and coldspots (**negative Gi**). The map also includes borders, a title, a compass, a scale bar, and a grid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2022)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          title = \"Gi*\",\n          midpoint = 0) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"2022 Hotspots & Coldspots of drug\\n use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-186-1.png){width=1152}\n:::\n:::\n\n\n### Map of Statistically Significant Hotspots & Coldspots of Drug Use Cases\n\nWe then create a map similar to the previous one but filters the data to only show provinces where the **p_sim value is less than 0.05** (indicating statistically significant results). It visualizes the **statistically significant** **hotspots** **and** **coldspots**, with **gi_star** values categorized into specific intervals (`breaks = c(-2, 0, 2, 4, 6, 8)`), and includes a histogram in the legend for distribution reference.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_2022_sig <- HCSA_2022  %>%\n  filter(p_sim < 0.05)\n\ntm_shape(HCSA_2022) +\n  tm_polygons() +\ntm_shape(HCSA_2022_sig)+\n  tm_fill(\"gi_star\", \n          title = \"Gi*\",\n          palette = c(\"#57bfc0\", \"#7977f3\",\"#f8d673\",\"#f8b675\",\"#f67774\"),\n          breaks = c(-2, 0, 2, 4, 6, 8), \n          midpoint = 0,\n          legend.hist = TRUE, \n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_layout(main.title = \"Statistically Significant Hotspots & Coldspots \\nof Drug use cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.title.size = 1.8,\n            legend.text.size = 1.3,\n            legend.outside = TRUE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-187-1.png){width=1152}\n:::\n:::\n\n\n### Top Hotspots and Coldspots Identification\n\nWe then identify the top hotspot provinces (with the **highest** **positive** **gi_star** values) and the top coldspot provinces (with the **lowest negative gi_star** values). It uses the filtered `HCSA_<current_year>_sig` dataset and arranges the values in descending and ascending order, respectively, to extract the top provinces.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the top 3 hotspots (highest positive gi_star values)\ntop_hotspots <- HCSA_2022_sig %>%\n  arrange(desc(gi_star)) %>%\n  head(3) %>%\n  pull(province_en)\n\n# Get the top 3 cold spots (lowest negative gi_star values)\ntop_coldspots <- HCSA_2022_sig %>%\n  filter(!(province_en %in% top_hotspots)) %>%\n  arrange(gi_star) %>%\n  head(3) %>%\n  pull(province_en)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_top_hotspots <- HCSA_2022_sig %>% filter(province_en %in% top_hotspots)\nHCSA_top_coldspots <- HCSA_2022_sig %>% filter(province_en %in% top_coldspots)\n\ntm_shape(HCSA_2022) +\n  tm_polygons() +\ntm_shape(HCSA_top_hotspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#f67774\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\",auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Hotspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-189-1.png){width=1152}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(HCSA_2022) +\n  tm_polygons() +\ntm_shape(HCSA_top_coldspots)+\n  tm_fill(\"gi_star\", \n          palette = c(\"#57bfc0\")) +\n  tm_borders(col = \"black\", alpha = 0.6)+\n  tm_text(\"province_en\", auto.placement = T)+\n  tm_layout(main.title = \"Most Significant Coldspots of Drug use\\n cases in Thailand\",\n            main.title.position = \"center\",\n            main.title.size = 1.7,\n            main.title.fontface = \"bold\",\n            legend.show = FALSE,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", text.size = 1.5, size = 3, position=c(\"RIGHT\", \"TOP\")) +\n  tm_scale_bar(position=c(\"LEFT\", \"BOTTOM\"), text.size=1.2) +\n  tm_grid(labels.size = 1,alpha =0.2)\n```\n\n::: {.cell-output-display}\n![](Take-home_ex02_files/figure-html/unnamed-chunk-190-1.png){width=1152}\n:::\n:::\n\n:::\n\n### 2.8.2 Discussion and Analysis\n\nThis spatial analysis enables better decision-making by highlighting areas that require focused attention. Identifying hotspots helps in targeting resources and interventions effectively, while coldspot areas provide insights into regions with fewer concerns. As demonstrated through the visualization, the Gi\\* analysis provides a clear and interpretable way to detect and map statistically significant clusters, facilitating data-driven policies and more informed public health strategies.\n\nIn general, the trend of drug use cases in Thailand from 2017 to 2022 generally aligns with the patterns revealed by the Local Indicator of Spatial Association (LISA) analysis. This suggests a consistent spatial clustering of drug-related incidents, where certain regions experience persistent high or low rates of drug use. The LISA analysis helps identify statistically significant hotspots and coldspots, reinforcing the spatial dependency observed in the distribution of these cases over the years.\n\n## 2.9 Conclusion\n\nThe spatial analysis of drug-related cases in Thailand from 2017 to 2022, using Local Getis-Ord Gi and Local Indicator of Spatial Association (LISA), reveals distinct regional patterns that indicate both persistent hotspots and coldspots across different years. The northeastern region consistently exhibits **High-High** clusters, particularly in border provinces, suggesting an ongoing concentration of drug-related issues in those areas, highlighting them as persistent hotspots. These regions demand focused interventions to curb drug-related activities.\n\nConversely, the central and western regions show a contrasting trend with **Low-Low** clusters, signifying areas with stable, low drug-use rates, referred to as coldspots. The continued presence of these clusters across multiple years suggests the effectiveness of existing measures in maintaining lower levels of drug-related incidents in these regions. The spillover effects between neighboring regions, such as the emergence of **Low-High** and **High-Low** clusters, reflect transitional areas where drug-use trends might be shifting, requiring proactive monitoring and intervention strategies.\n\nOverall, the combination of **High-High** and **Low-Low** clusters over the years demonstrates the evolving drug-use landscape in Thailand, necessitating a tailored approach to addressing both the hotspots and coldspots identified by spatial autocorrelation techniques like LISA and Local Getis-Ord Gi.\n\n::: {.callout-tip title=\"Key Recommendations\"}\nTo effectively address the evolving landscape of drug use in Thailand, the authorities should adopt a data-driven, region-specific approach based on the spatial patterns observed in drug-related incidents from 2017 to 2022. Here are some key recommendations:\n\n1.  **Focus on Persistent Hotspots**: The northeastern region, particularly along the border provinces, consistently shows **High-High** clusters, indicating areas with a high concentration of drug-related cases. Thai authorities should prioritize these areas by intensifying law enforcement efforts, increasing surveillance, and providing targeted interventions. Coordinated cross-border efforts with neighboring countries might also help reduce the flow of drugs in these regions.\n\n2.  **Strengthen Monitoring in Transitional Areas**: The presence of **High-Low** and **Low-High** clusters in both the northeastern and central regions indicates areas where drug use trends may be shifting. Thai authorities should closely monitor these transitional areas to prevent the potential spillover of drug-related activities from high-incident to low-incident regions. Early intervention in these areas can help prevent further escalation of drug use.\n\n3.  **Sustain Coldspots with Preventive Measures**: In regions such as the central and western areas where **Low-Low** clusters are observed, authorities should continue supporting community-based preventive programs, education campaigns, and rehabilitation services. These measures have likely contributed to maintaining low levels of drug-related cases, and ensuring their sustainability will help preserve these coldspots.\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}